import{j as e,ao as H,aD as G,ae as V,G as W,r as o,a8 as q,am as X,ag as Y}from"./react-vendor-zXfd7Ve7.js";import{C as b,a as N,b as y,c as w,f as h,d as T,s as J}from"./index-D8webL0o.js";import{D as z}from"./DashboardNav-ZSGo2elE.js";import{T as Q,R as _,L as Z,H as M,X as K,Y as P,I as ee,J as se,K as te}from"./vendor-BOHFvtXa.js";import{B as E}from"./badge-C_-9dwWz.js";import{T as re,a as ae,b as C,c as A}from"./tabs-jniJqZuw.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";function ne(){const s=[{title:"Avg Time to Recovery",value:"4.2 days",icon:H,color:"text-blue-600",bgColor:"bg-blue-50"},{title:"Overall Recovery Rate",value:"78.5%",icon:G,color:"text-green-600",bgColor:"bg-green-50"},{title:"Total Emails Sent",value:"1,247",icon:V,color:"text-purple-600",bgColor:"bg-purple-50"},{title:"Revenue Recovered",value:"$18,420",icon:W,color:"text-emerald-600",bgColor:"bg-emerald-50"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map(t=>e.jsxs(b,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(y,{className:"text-sm font-medium text-slate-600",children:t.title}),e.jsx("div",{className:`p-2 rounded-lg ${t.bgColor}`,children:e.jsx(t.icon,{className:`w-5 h-5 ${t.color}`})})]}),e.jsx(w,{children:e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:t.value})})]},t.title))})}const le={light:"",dark:".dark"},O=o.createContext(null);function I(){const s=o.useContext(O);if(!s)throw new Error("useChart must be used within a <ChartContainer />");return s}const S=o.forwardRef(({id:s,className:t,children:a,config:n,...c},x)=>{const i=o.useId(),r=`chart-${s||i.replace(/:/g,"")}`;return e.jsx(O.Provider,{value:{config:n},children:e.jsxs("div",{"data-chart":r,ref:x,className:h("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/40 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border/60 [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border/40 [&_.recharts-radial-bar-background-sector]:fill-muted/50 [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted/80 [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border/40 [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",t),...c,children:[e.jsx(ce,{id:r,config:n}),e.jsx(_,{children:a})]})})});S.displayName="Chart";const ce=({id:s,config:t})=>{const a=Object.entries(t).filter(([n,c])=>c.theme||c.color);return a.length?e.jsx("style",{dangerouslySetInnerHTML:{__html:Object.entries(le).map(([n,c])=>`
${c} [data-chart=${s}] {
${a.map(([x,i])=>{const r=i.theme?.[n]||i.color;return r?`  --color-${x}: ${r};`:null}).join(`
`)}
}
`).join(`
`)}}):null},U=Q,B=o.forwardRef(({active:s,payload:t,className:a,indicator:n="dot",hideLabel:c=!1,hideIndicator:x=!1,label:i,labelFormatter:r,labelClassName:m,formatter:d,color:p,nameKey:g,labelKey:j},F)=>{const{config:v}=I(),$=o.useMemo(()=>{if(c||!t?.length)return null;const[l]=t,k=`${j||l.dataKey||l.name||"value"}`,R=D(v,l,k),u=!j&&typeof i=="string"?v[i]?.label||i:R?.label;return r?e.jsx("div",{className:h("font-medium",m),children:r(u,t)}):u?e.jsx("div",{className:h("font-medium",m),children:u}):null},[i,r,t,c,m,v,j]);if(!s||!t?.length)return null;const f=t.length===1&&n!=="dot";return e.jsxs("div",{ref:F,className:h("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background/95 backdrop-blur-sm px-2.5 py-1.5 text-xs shadow-xl",a),children:[f?null:$,e.jsx("div",{className:"grid gap-1.5",children:t.map((l,k)=>{const R=`${g||l.name||l.dataKey||"value"}`,u=D(v,l,R),L=p||l.payload.fill||l.color;return e.jsx("div",{className:h("flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",n==="dot"&&"items-center"),children:d&&l?.value!==void 0&&l.name?d(l.value,l.name,l,k,l.payload):e.jsxs(e.Fragment,{children:[u?.icon?e.jsx(u.icon,{}):!x&&e.jsx("div",{className:h("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":n==="dot","w-1":n==="line","w-0 border-[1.5px] border-dashed bg-transparent":n==="dashed","my-0.5":f&&n==="dashed"}),style:{"--color-bg":L,"--color-border":L}}),e.jsxs("div",{className:h("flex flex-1 justify-between leading-none",f?"items-end":"items-center"),children:[e.jsxs("div",{className:"grid gap-1.5",children:[f?$:null,e.jsx("span",{className:"text-muted-foreground",children:u?.label||l.name})]}),l.value&&e.jsx("span",{className:"font-mono font-medium tabular-nums text-foreground",children:l.value.toLocaleString()})]})]})},l.dataKey)})})]})});B.displayName="ChartTooltip";const ie=o.forwardRef(({className:s,hideIcon:t=!1,payload:a,verticalAlign:n="bottom",nameKey:c},x)=>{const{config:i}=I();return a?.length?e.jsx("div",{ref:x,className:h("flex items-center justify-center gap-4",n==="top"?"pb-3":"pt-3",s),children:a.map(r=>{const m=`${c||r.dataKey||"value"}`,d=D(i,r,m);return e.jsxs("div",{className:h("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground"),children:[d?.icon&&!t?e.jsx(d.icon,{}):e.jsx("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:r.color}}),d?.label]},r.value)})}):null});ie.displayName="ChartLegend";function D(s,t,a){if(typeof t!="object"||t===null)return;const n="payload"in t&&typeof t.payload=="object"&&t.payload!==null?t.payload:void 0;let c=a;return a in t&&typeof t[a]=="string"?c=t[a]:n&&a in n&&typeof n[a]=="string"&&(c=n[a]),c in s?s[c]:s[a]}const oe=[{week:"Week 1",recoveryRate:65,recovered:12,attempted:18},{week:"Week 2",recoveryRate:72,recovered:18,attempted:25},{week:"Week 3",recoveryRate:68,recovered:15,attempted:22},{week:"Week 4",recoveryRate:78,recovered:21,attempted:27},{week:"Week 5",recoveryRate:75,recovered:24,attempted:32},{week:"Week 6",recoveryRate:82,recovered:28,attempted:34},{week:"Week 7",recoveryRate:80,recovered:32,attempted:40},{week:"Week 8",recoveryRate:85,recovered:34,attempted:40}];function de(){return e.jsxs(b,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Recovery Rate Trends"}),e.jsx(T,{children:"Weekly recovery performance over the last 8 weeks"})]}),e.jsx(w,{children:e.jsx(S,{config:{recoveryRate:{label:"Recovery Rate",color:"hsl(142, 76%, 36%)"}},className:"h-[300px]",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Z,{data:oe,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"week"}),e.jsx(P,{}),e.jsx(U,{content:e.jsx(B,{})}),e.jsx(ee,{type:"monotone",dataKey:"recoveryRate",stroke:"hsl(142, 76%, 36%)",strokeWidth:2})]})})})})]})}const xe=[{sequence:"Day 1 Reminder",sent:120,recovered:45,rate:37.5},{sequence:"Day 3 Urgent",sent:75,recovered:28,rate:37.3},{sequence:"Day 7 Final",sent:47,recovered:22,rate:46.8},{sequence:"Day 10 Offer",sent:25,recovered:15,rate:60},{sequence:"Day 14 Last",sent:10,recovered:3,rate:30}];function me(){return e.jsxs(b,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"Email Sequence Performance"}),e.jsx(T,{children:"Recovery rates by email sequence timing"})]}),e.jsx(w,{children:e.jsx(S,{config:{rate:{label:"Recovery Rate",color:"hsl(221, 83%, 53%)"}},className:"h-[300px]",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(se,{data:xe,children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"sequence"}),e.jsx(P,{}),e.jsx(U,{content:e.jsx(B,{})}),e.jsx(te,{dataKey:"rate",fill:"hsl(221, 83%, 53%)"})]})})})})]})}const he=[{id:1,name:"Subject Line: Urgent vs Friendly",variantA:{name:"Urgent Tone",rate:68,sent:150},variantB:{name:"Friendly Tone",rate:75,sent:150},winner:"B",improvement:10.3},{id:2,name:"Discount Offer: 20% vs 30%",variantA:{name:"20% Discount",rate:55,sent:120},variantB:{name:"30% Discount",rate:62,sent:120},winner:"B",improvement:12.7},{id:3,name:"Email Timing: Morning vs Evening",variantA:{name:"Morning (9AM)",rate:72,sent:180},variantB:{name:"Evening (6PM)",rate:68,sent:180},winner:"A",improvement:5.9}];function ue(){return e.jsxs(b,{children:[e.jsxs(N,{children:[e.jsx(y,{children:"A/B Test Results"}),e.jsx(T,{children:"Dunning strategy experiments and outcomes"})]}),e.jsx(w,{className:"space-y-4",children:he.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-3",children:s.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:`p-3 rounded ${s.winner==="A"?"bg-green-50 border border-green-200":"bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Variant A"}),s.winner==="A"&&e.jsx(E,{className:"bg-green-600",children:"Winner"})]}),e.jsx("p",{className:"text-xs text-slate-600 mb-2",children:s.variantA.name}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.variantA.rate,"%"]})]}),e.jsxs("div",{className:`p-3 rounded ${s.winner==="B"?"bg-green-50 border border-green-200":"bg-slate-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Variant B"}),s.winner==="B"&&e.jsx(E,{className:"bg-green-600",children:"Winner"})]}),e.jsx("p",{className:"text-xs text-slate-600 mb-2",children:s.variantB.name}),e.jsxs("p",{className:"text-2xl font-bold",children:[s.variantB.rate,"%"]})]})]}),e.jsxs("div",{className:"mt-3 flex items-center text-sm text-green-600",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[s.improvement,"% improvement"]})]})]},s.id))})]})}function we(){const[s,t]=o.useState({atRisk:0,recovered:0,lost:0,recoveryRate:0,totalAtRisk:0}),[a,n]=o.useState([]),[c,x]=o.useState(!0);o.useEffect(()=>{i()},[]);const i=async()=>{try{const{data:r}=await J.from("profiles").select("*").eq("subscription_status","past_due"),m=r?.length||0,d=12,p=3,g=m+d+p,j=g>0?d/g*100:0;t({atRisk:m,recovered:d,lost:p,recoveryRate:j,totalAtRisk:m*29}),n(r||[])}catch(r){console.error("Error loading dunning data:",r)}finally{x(!1)}};return e.jsxs("div",{className:"flex min-h-screen bg-slate-50",children:[e.jsx(z,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-8",children:"Dunning Management"}),e.jsxs(re,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(ae,{children:[e.jsx(C,{value:"overview",children:"Overview"}),e.jsx(C,{value:"analytics",children:"Analytics"}),e.jsx(C,{value:"at-risk",children:"At-Risk Subscriptions"})]}),e.jsx(A,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(X,{className:"w-8 h-8 text-red-600"})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:s.atRisk}),e.jsx("p",{className:"text-slate-600",children:"At Risk"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(q,{className:"w-8 h-8 text-green-600"})}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:[s.recoveryRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-slate-600",children:"Recovery Rate"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Y,{className:"w-8 h-8 text-blue-600"})}),e.jsx("p",{className:"text-3xl font-bold text-slate-900",children:s.recovered}),e.jsx("p",{className:"text-slate-600",children:"Recovered"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(W,{className:"w-8 h-8 text-purple-600"})}),e.jsxs("p",{className:"text-3xl font-bold text-slate-900",children:["$",s.totalAtRisk]}),e.jsx("p",{className:"text-slate-600",children:"At Risk MRR"})]})]})}),e.jsxs(A,{value:"analytics",className:"space-y-6",children:[e.jsx(ne,{}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(de,{}),e.jsx(me,{})]}),e.jsx(ue,{})]}),e.jsx(A,{value:"at-risk",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h3",{className:"text-xl font-semibold text-slate-900",children:"At-Risk Subscriptions"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Attempts"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Grace Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase",children:"Amount"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200",children:[a.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-slate-900",children:r.email}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded bg-red-100 text-red-700",children:"Past Due"})}),e.jsxs("td",{className:"px-6 py-4 text-sm text-slate-900",children:[r.payment_attempts||1,"/3"]}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-900",children:r.grace_period_end?new Date(r.grace_period_end).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-6 py-4 text-sm text-slate-900",children:"$29.00"})]},r.id)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-slate-500",children:"No at-risk subscriptions"})})]})]})})]})})]})]})})]})}export{we as default};
//# sourceMappingURL=Dunning-BoW6Ruzx.js.map
