{"version":3,"file":"Success-DESdoTPk.js","sources":["../../src/pages/Success.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { useSearchParams, Link } from 'react-router-dom';\nimport { supabase } from '@/lib/supabase';\n\nexport default function Success() {\n  const [searchParams] = useSearchParams();\n  const orderId = searchParams.get('order');\n  const [order, setOrder] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n  const [downloading, setDownloading] = useState(false);\n\n  useEffect(() => {\n    loadOrder();\n  }, [orderId]);\n\n  const loadOrder = async () => {\n    if (!orderId) {\n      setLoading(false);\n      return;\n    }\n\n    const { data } = await supabase\n      .from('orders')\n      .select('*, products(*), shops(*, profiles(*))')\n      .eq('id', orderId)\n      .single();\n\n    setOrder(data);\n    setLoading(false);\n  };\n\n  const handleDownload = async () => {\n    if (!order?.download_token) return;\n    \n    setDownloading(true);\n    try {\n      // In production, this would download from secure storage\n      const downloadUrl = order.products.file_url;\n      \n      // Increment download count\n      await supabase\n        .from('orders')\n        .update({ download_count: (order.download_count || 0) + 1 })\n        .eq('id', order.id);\n      \n      // Trigger download\n      window.open(downloadUrl, '_blank');\n    } catch (error) {\n      console.error('Download error:', error);\n      alert('Failed to download. Please contact support.');\n    } finally {\n      setDownloading(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\n        <p className=\"text-slate-600\">Loading...</p>\n      </div>\n    );\n  }\n\n  if (!order) {\n    return (\n      <div className=\"min-h-screen bg-slate-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-slate-600 mb-4\">Order not found</p>\n          <Link to=\"/\" className=\"text-pale skin-600 hover:underline\">Go to homepage</Link>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-slate-50 py-12 px-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        <div className=\"bg-white rounded-lg shadow-lg p-8 text-center\">\n          <div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6\">\n            <svg className=\"w-8 h-8 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n            </svg>\n          </div>\n\n          <h1 className=\"text-3xl font-bold text-slate-900 mb-4\">Thank you for your purchase!</h1>\n          <p className=\"text-slate-600 mb-8\">\n            Your order has been confirmed. A receipt has been sent to <strong>{order.customer_email}</strong>.\n          </p>\n\n          <div className=\"border-t border-slate-200 pt-6 mb-6\">\n            <div className=\"flex justify-between items-center mb-2\">\n              <span className=\"text-slate-600\">Product:</span>\n              <span className=\"font-semibold text-slate-900\">{order.products.name}</span>\n            </div>\n            <div className=\"flex justify-between items-center mb-2\">\n              <span className=\"text-slate-600\">Amount:</span>\n              <span className=\"font-semibold text-slate-900\">${order.amount}</span>\n            </div>\n            <div className=\"flex justify-between items-center\">\n              <span className=\"text-slate-600\">Order ID:</span>\n              <span className=\"font-mono text-sm text-slate-600\">{order.id.slice(0, 8)}</span>\n            </div>\n          </div>\n\n          {order.products.type === 'digital' && order.download_token && (\n            <div className=\"bg-pale skin-50 border border-pale skin-200 rounded-lg p-4 mb-6\">\n              <p className=\"text-pale skin-900 mb-3\">Your download link has been sent to your email.</p>\n              <button \n                onClick={handleDownload}\n                disabled={downloading}\n                className=\"px-6 py-3 bg-pale skin-600 text-white rounded-lg font-semibold hover:bg-pale skin-700 transition disabled:opacity-50\"\n              >\n                {downloading ? 'Downloading...' : 'Download Now'}\n              </button>\n              {order.download_count > 0 && (\n                <p className=\"text-sm text-slate-600 mt-2\">\n                  Downloaded {order.download_count} time{order.download_count !== 1 ? 's' : ''}\n                </p>\n              )}\n            </div>\n          )}\n\n          {order.products.type === 'course' && (\n            <div className=\"bg-pale skin-50 border border-pale skin-200 rounded-lg p-4 mb-6\">\n              <p className=\"text-pale skin-900 mb-3\">You now have access to the course!</p>\n              <Link\n                to={`/course/${order.products.id}`}\n                className=\"inline-block px-6 py-3 bg-pale skin-600 text-white rounded-lg font-semibold hover:bg-pale skin-700 transition\"\n              >\n                Start Learning\n              </Link>\n            </div>\n          )}\n\n          {order.products.type === 'service' && (\n            <div className=\"bg-pale skin-50 border border-pale skin-200 rounded-lg p-4 mb-6\">\n              <p className=\"text-pale skin-900\">Check your email for booking confirmation and next steps.</p>\n            </div>\n          )}\n\n          <Link\n            to={`/store/${order.shops.profiles.username}`}\n            className=\"inline-block text-pale skin-600 hover:underline mt-4\"\n          >\n            Back to store\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n"],"names":["Success","searchParams","useSearchParams","orderId","order","setOrder","useState","loading","setLoading","downloading","setDownloading","useEffect","loadOrder","data","supabase","handleDownload","downloadUrl","error","jsx","jsxs","Link"],"mappings":"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"}