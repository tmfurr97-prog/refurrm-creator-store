import{r as m,j as e,a0 as B,n as z,ad as I,X as V,U as O,aE as $,ab as K,an as W,bP as Q,Q as Y,bQ as H}from"./react-vendor-zXfd7Ve7.js";import{h as G,s as p,C as _,a as f,b,d as w,c as C,L as i,A as L,e as A,I as o,B as h,u as X,T as R}from"./index-k1V3dZSG.js";import{T as q,a as M,b as N,c as S}from"./tabs-DyFoJc2q.js";import{S as J,a as Z,b as ee,c as se,d as E}from"./select-C3Vw_1bu.js";import{S as D}from"./switch-IuCVSr7H.js";import{G as u}from"./vendor-BOHFvtXa.js";import{D as ae}from"./DashboardNav-dXlKSIlC.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";function re(){const{user:d}=G(),[x,j]=m.useState(!1),[a,t]=m.useState(!1),[n,c]=m.useState({test_mode:!0,stripe_publishable_key:"",stripe_secret_key:"",stripe_webhook_secret:"",is_active:!1}),[s,g]=m.useState({test_mode:!0,paypal_client_id:"",paypal_secret:"",is_active:!1});m.useEffect(()=>{y()},[d]);const y=async()=>{if(!d)return;const{data:r}=await p.from("payment_gateways").select("*").eq("user_id",d.id);r&&r.forEach(l=>{l.provider==="stripe"?c({test_mode:l.test_mode,stripe_publishable_key:l.stripe_publishable_key||"",stripe_secret_key:l.stripe_secret_key||"",stripe_webhook_secret:l.stripe_webhook_secret||"",is_active:l.is_active}):l.provider==="paypal"&&g({test_mode:l.test_mode,paypal_client_id:l.paypal_client_id||"",paypal_secret:l.paypal_secret||"",is_active:l.is_active})})},k=async()=>{if(!d)return;j(!0);const{error:r}=await p.from("payment_gateways").upsert({user_id:d.id,provider:"stripe",...n});j(!1),r?u.error("Failed to save Stripe configuration"):u.success("Stripe configuration saved!")},v=async()=>{if(!d)return;j(!0);const{error:r}=await p.from("payment_gateways").upsert({user_id:d.id,provider:"paypal",...s});j(!1),r?u.error("Failed to save PayPal configuration"):u.success("PayPal configuration saved!")},T=async r=>{t(!0);try{const l=r==="stripe"?n:s,{data:P,error:F}=await p.functions.invoke("verify-payment-gateway",{body:{provider:r,testMode:l.test_mode,apiKey:r==="stripe"?l.stripe_secret_key:l.paypal_secret,clientId:r==="paypal"?l.paypal_client_id:void 0}});if(F)throw F;P.success?u.success(P.message):u.error(P.message)}catch(l){u.error("Connection test failed: "+l.message)}t(!1)},U=r=>{navigator.clipboard.writeText(r),u.success("Copied to clipboard!")};return e.jsxs(q,{defaultValue:"stripe",className:"space-y-4",children:[e.jsxs(M,{className:"grid w-full grid-cols-2",children:[e.jsx(N,{value:"stripe",children:"Stripe"}),e.jsx(N,{value:"paypal",children:"PayPal"})]}),e.jsx(S,{value:"stripe",children:e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"Stripe Configuration"}),e.jsx(w,{children:"Connect your Stripe account to accept payments"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Test Mode"}),e.jsx(D,{checked:n.test_mode,onCheckedChange:r=>c({...n,test_mode:r})})]}),e.jsxs(L,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(A,{children:n.test_mode?"Using test keys. No real charges will be made.":"Using live keys. Real charges will be processed!"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Publishable Key"}),e.jsx(o,{type:"password",value:n.stripe_publishable_key,onChange:r=>c({...n,stripe_publishable_key:r.target.value}),placeholder:n.test_mode?"pk_test_...":"pk_live_..."})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Secret Key"}),e.jsx(o,{type:"password",value:n.stripe_secret_key,onChange:r=>c({...n,stripe_secret_key:r.target.value}),placeholder:n.test_mode?"sk_test_...":"sk_live_..."})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Webhook Secret (Optional)"}),e.jsx(o,{type:"password",value:n.stripe_webhook_secret,onChange:r=>c({...n,stripe_webhook_secret:r.target.value}),placeholder:"whsec_..."})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Webhook Setup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add this URL to your Stripe webhooks:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("code",{className:"flex-1 bg-white p-2 rounded text-xs",children:[window.location.origin,"/api/stripe-webhook"]}),e.jsx(h,{size:"sm",variant:"outline",onClick:()=>U(`${window.location.origin}/api/stripe-webhook`),children:e.jsx(z,{className:"w-4 h-4"})})]}),e.jsxs(h,{size:"sm",variant:"link",onClick:()=>window.open("https://dashboard.stripe.com/webhooks","_blank"),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Open Stripe Dashboard"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Enable Stripe Payments"}),e.jsx(D,{checked:n.is_active,onCheckedChange:r=>c({...n,is_active:r})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:k,disabled:x,className:"flex-1",children:"Save Configuration"}),e.jsx(h,{onClick:()=>T("stripe"),disabled:a||!n.stripe_secret_key,variant:"outline",children:"Test Connection"})]})]})]})}),e.jsx(S,{value:"paypal",children:e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsx(b,{children:"PayPal Configuration"}),e.jsx(w,{children:"Connect your PayPal account to accept payments"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Test Mode (Sandbox)"}),e.jsx(D,{checked:s.test_mode,onCheckedChange:r=>g({...s,test_mode:r})})]}),e.jsxs(L,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(A,{children:s.test_mode?"Using sandbox credentials. No real charges will be made.":"Using live credentials. Real charges will be processed!"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Client ID"}),e.jsx(o,{type:"password",value:s.paypal_client_id,onChange:r=>g({...s,paypal_client_id:r.target.value}),placeholder:"Client ID from PayPal"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Secret"}),e.jsx(o,{type:"password",value:s.paypal_secret,onChange:r=>g({...s,paypal_secret:r.target.value}),placeholder:"Secret from PayPal"})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Getting PayPal Credentials"}),e.jsxs("ol",{className:"text-sm text-gray-600 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Go to PayPal Developer Dashboard"}),e.jsx("li",{children:"Create a new app or select existing"}),e.jsx("li",{children:"Copy Client ID and Secret"}),e.jsx("li",{children:"Toggle between Sandbox/Live as needed"})]}),e.jsxs(h,{size:"sm",variant:"link",onClick:()=>window.open("https://developer.paypal.com/dashboard/","_blank"),children:[e.jsx(I,{className:"w-4 h-4 mr-2"}),"Open PayPal Developer Dashboard"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Enable PayPal Payments"}),e.jsx(D,{checked:s.is_active,onCheckedChange:r=>g({...s,is_active:r})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{onClick:v,disabled:x,className:"flex-1",children:"Save Configuration"}),e.jsx(h,{onClick:()=>T("paypal"),disabled:a||!s.paypal_client_id,variant:"outline",children:"Test Connection"})]})]})]})})]})}function ie({currentLogo:d,onLogoUpdate:x}){const[j,a]=m.useState(!1),[t,n]=m.useState(d),{toast:c}=X(),s=async y=>{const k=y.target.files?.[0];if(k){if(!k.type.startsWith("image/")){c({title:"Please upload an image file",variant:"destructive"});return}a(!0);try{const{data:{user:v}}=await p.auth.getUser();if(!v)throw new Error("Not authenticated");const T=k.name.split(".").pop(),U=`${v.id}-${Date.now()}.${T}`,{error:r}=await p.storage.from("store-logos").upload(U,k,{upsert:!0});if(r)throw r;const{data:{publicUrl:l}}=p.storage.from("store-logos").getPublicUrl(U),{error:P}=await p.from("user_profiles").update({store_logo_url:l}).eq("id",v.id);if(P)throw P;n(l),x(l),c({title:"Logo uploaded successfully!"})}catch(v){c({title:"Upload failed",description:v.message,variant:"destructive"})}finally{a(!1)}}},g=async()=>{try{const{data:{user:y}}=await p.auth.getUser();if(!y)return;await p.from("user_profiles").update({store_logo_url:null}).eq("id",y.id),n(void 0),x(""),c({title:"Logo removed"})}catch(y){c({title:"Error",description:y.message,variant:"destructive"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(i,{children:"Store Logo"}),t?e.jsxs("div",{className:"relative w-48 h-48 border rounded-lg overflow-hidden",children:[e.jsx("img",{src:t,alt:"Store logo",className:"w-full h-full object-contain"}),e.jsx(h,{size:"sm",variant:"destructive",className:"absolute top-2 right-2",onClick:g,children:e.jsx(V,{className:"w-4 h-4"})})]}):e.jsx("div",{className:"w-48 h-48 border-2 border-dashed rounded-lg flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No logo uploaded"})]})}),e.jsxs("div",{children:[e.jsx(o,{type:"file",accept:"image/*",onChange:s,disabled:j,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Recommended: Square image, at least 200x200px"})]})]})}function ue(){const{user:d}=G(),[x,j]=m.useState(!1),[a,t]=m.useState({store_name:"",store_description:"",store_url:"",logo_url:"",custom_domain:"",primary_color:"#6366f1",secondary_color:"#8b5cf6",currency:"USD",tax_rate:0,enable_shipping:!0,shipping_flat_rate:0,free_shipping_threshold:0,payment_methods:[],business_name:"",business_email:"",business_phone:"",business_address:""});m.useEffect(()=>{n()},[d]);const n=async()=>{if(!d)return;const{data:s}=await p.from("user_profiles").select("*").eq("id",d.id).single();s&&t(g=>({...g,...s}))},c=async()=>{if(!d)return;j(!0);const{error:s}=await p.from("user_profiles").update(a).eq("id",d.id);j(!1),s?u.error("Failed to save store settings"):u.success("Store settings saved successfully!")};return e.jsxs("div",{className:"flex min-h-screen bg-gray-50",children:[e.jsx(ae,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Store Builder"}),e.jsx("p",{className:"text-gray-600",children:"Configure your online store settings"})]}),e.jsxs(q,{defaultValue:"branding",className:"space-y-6",children:[e.jsxs(M,{className:"grid w-full grid-cols-5",children:[e.jsx(N,{value:"branding",children:"Branding"}),e.jsx(N,{value:"business",children:"Business"}),e.jsx(N,{value:"payments",children:"Payments"}),e.jsx(N,{value:"shipping",children:"Shipping"}),e.jsx(N,{value:"products",children:"Products"})]}),e.jsx(S,{value:"branding",children:e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5"}),"Store Branding"]}),e.jsx(w,{children:"Customize your store's appearance"})]}),e.jsxs(C,{className:"space-y-6",children:[e.jsx(ie,{currentLogo:a.logo_url,onLogoUpdate:s=>t({...a,logo_url:s})}),e.jsxs("div",{children:[e.jsx(i,{children:"Store Name"}),e.jsx(o,{value:a.store_name,onChange:s=>t({...a,store_name:s.target.value}),placeholder:"My Awesome Store"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Store Description"}),e.jsx(R,{value:a.store_description,onChange:s=>t({...a,store_description:s.target.value}),placeholder:"Tell customers about your store...",rows:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Primary Color"}),e.jsx(o,{type:"color",value:a.primary_color,onChange:s=>t({...a,primary_color:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Secondary Color"}),e.jsx(o,{type:"color",value:a.secondary_color,onChange:s=>t({...a,secondary_color:s.target.value})})]})]}),e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Custom Domain"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Domain Name"}),e.jsx(o,{value:a.custom_domain||"",onChange:s=>t({...a,custom_domain:s.target.value}),placeholder:"shop.yourdomain.com"})]}),e.jsxs(L,{children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs(A,{children:[e.jsx("p",{className:"font-semibold mb-2",children:"DNS Configuration:"}),e.jsx("p",{className:"text-sm mb-1",children:"Add a CNAME record:"}),e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:"shop.yourdomain.com â†’ your-store.refurrm.app"}),e.jsx("p",{className:"text-sm mt-2",children:"SSL certificates are automatically provisioned once DNS is configured."})]})]})]})]}),e.jsx(h,{onClick:c,disabled:x,children:"Save Branding"})]})]})}),e.jsx(S,{value:"business",children:e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5"}),"Business Information"]}),e.jsx(w,{children:"Your business details for invoices and legal"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Business Name"}),e.jsx(o,{value:a.business_name,onChange:s=>t({...a,business_name:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Business Email"}),e.jsx(o,{type:"email",value:a.business_email,onChange:s=>t({...a,business_email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Business Phone"}),e.jsx(o,{type:"tel",value:a.business_phone,onChange:s=>t({...a,business_phone:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Business Address"}),e.jsx(R,{value:a.business_address,onChange:s=>t({...a,business_address:s.target.value}),rows:3})]}),e.jsx(h,{onClick:c,disabled:x,children:"Save Business Info"})]})]})}),e.jsx(S,{value:"payments",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Payment Settings"]}),e.jsx(w,{children:"Configure payment methods and pricing"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{children:"Currency"}),e.jsxs(J,{value:a.currency,onValueChange:s=>t({...a,currency:s}),children:[e.jsx(Z,{children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(E,{value:"USD",children:"USD - US Dollar"}),e.jsx(E,{value:"EUR",children:"EUR - Euro"}),e.jsx(E,{value:"GBP",children:"GBP - British Pound"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Tax Rate (%)"}),e.jsx(o,{type:"number",value:a.tax_rate,onChange:s=>t({...a,tax_rate:parseFloat(s.target.value)}),step:"0.01"})]}),e.jsx(h,{onClick:c,disabled:x,children:"Save Payment Settings"})]})]}),e.jsx(re,{})]})}),e.jsx(S,{value:"shipping",children:e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Shipping Options"]}),e.jsx(w,{children:"Set up shipping rates and options"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(i,{children:"Enable Shipping"}),e.jsx(D,{checked:a.enable_shipping,onCheckedChange:s=>t({...a,enable_shipping:s})})]}),a.enable_shipping&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(i,{children:"Flat Shipping Rate"}),e.jsx(o,{type:"number",value:a.shipping_flat_rate,onChange:s=>t({...a,shipping_flat_rate:parseFloat(s.target.value)}),step:"0.01"})]}),e.jsxs("div",{children:[e.jsx(i,{children:"Free Shipping Threshold"}),e.jsx(o,{type:"number",value:a.free_shipping_threshold,onChange:s=>t({...a,free_shipping_threshold:parseFloat(s.target.value)}),step:"0.01"})]})]}),e.jsx(h,{onClick:c,disabled:x,children:"Save Shipping Settings"})]})]})}),e.jsx(S,{value:"products",children:e.jsxs(_,{children:[e.jsxs(f,{children:[e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),"Product Management"]}),e.jsx(w,{children:"Add and manage your products"})]}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(h,{onClick:()=>window.location.href="/products/new",children:"Add New Product"}),e.jsx(h,{variant:"outline",onClick:()=>window.location.href="/products",children:"View All Products"})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs(h,{variant:"outline",className:"w-full",onClick:()=>window.location.href="/storefront",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Preview Your Storefront"]})})]})]})})]})]})})]})}export{ue as default};
//# sourceMappingURL=StoreBuilder-BhUWV3jC.js.map
