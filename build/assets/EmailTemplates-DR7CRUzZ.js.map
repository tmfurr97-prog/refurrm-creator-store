{"version":3,"file":"EmailTemplates-DR7CRUzZ.js","sources":["../../src/pages/EmailTemplates.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport DashboardNav from '@/components/DashboardNav';\n\ninterface EmailTemplate {\n  id: string;\n  name: string;\n  subject: string;\n  template_type: string;\n  html_content: string;\n  text_content: string;\n  merge_tags: string[];\n  is_active: boolean;\n}\n\nexport default function EmailTemplates() {\n  const { user } = useAuth();\n  const [templates, setTemplates] = useState<EmailTemplate[]>([]);\n  const [selectedTemplate, setSelectedTemplate] = useState<EmailTemplate | null>(null);\n  const [isEditing, setIsEditing] = useState(false);\n  const [formData, setFormData] = useState({\n    name: '',\n    subject: '',\n    template_type: 'welcome',\n    html_content: '',\n    text_content: '',\n  });\n\n  useEffect(() => {\n    loadTemplates();\n  }, []);\n\n  const loadTemplates = async () => {\n    const { data } = await supabase.from('email_templates').select('*').order('created_at', { ascending: false });\n    if (data) setTemplates(data);\n  };\n  const handleSave = async () => {\n    if (selectedTemplate) {\n      await supabase.from('email_templates').update(formData).eq('id', selectedTemplate.id);\n    } else {\n      await supabase.from('email_templates').insert({ ...formData, created_by: user?.id });\n    }\n    loadTemplates();\n    setIsEditing(false);\n    setSelectedTemplate(null);\n  };\n\n  const handleTestEmail = async () => {\n    if (!user?.email) return;\n    \n    // Replace merge tags with sample data\n    let testContent = formData.html_content;\n    testContent = testContent.replace(/{{name}}/g, user.user_metadata?.full_name || 'Customer');\n    testContent = testContent.replace(/{{email}}/g, user.email);\n    testContent = testContent.replace(/{{product}}/g, 'Sample Product');\n    testContent = testContent.replace(/{{order_id}}/g, '#12345');\n    testContent = testContent.replace(/{{amount}}/g, '$99.99');\n    testContent = testContent.replace(/{{link}}/g, 'https://example.com');\n\n    // In production, this would call an edge function to send email\n    console.log('Test email would be sent to:', user.email);\n    console.log('Content:', testContent);\n    alert(`Test email preview:\\n\\nTo: ${user.email}\\nSubject: ${formData.subject}\\n\\nContent has been logged to console.`);\n  };\n\n  const insertMergeTag = (tag: string) => {\n    setFormData({ ...formData, html_content: formData.html_content + ' ' + tag });\n  };\n\n\n  const handleEdit = (template: EmailTemplate) => {\n    setSelectedTemplate(template);\n    setFormData({\n      name: template.name,\n      subject: template.subject,\n      template_type: template.template_type,\n      html_content: template.html_content,\n      text_content: template.text_content,\n    });\n    setIsEditing(true);\n  };\n\n  const mergeTags = ['{{name}}', '{{email}}', '{{product}}', '{{order_id}}', '{{amount}}', '{{link}}'];\n\n  return (\n    <div className=\"min-h-screen bg-slate-900\">\n      <DashboardNav />\n      <div className=\"max-w-7xl mx-auto px-6 py-8\">\n        <h1 className=\"text-4xl font-black text-white mb-8\">Email Templates</h1>\n        \n        <div className=\"grid lg:grid-cols-3 gap-6\">\n          <Card className=\"lg:col-span-1 bg-slate-800 border-slate-700 p-6\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h2 className=\"text-xl font-bold text-white\">Templates</h2>\n              <Button onClick={() => { setIsEditing(true); setSelectedTemplate(null); }} size=\"sm\">New</Button>\n            </div>\n            <div className=\"space-y-2\">\n              {templates.map((t) => (\n                <div key={t.id} onClick={() => handleEdit(t)} className=\"p-3 bg-slate-700 rounded cursor-pointer hover:bg-slate-600\">\n                  <div className=\"font-semibold text-white\">{t.name}</div>\n                  <div className=\"text-sm text-slate-400\">{t.template_type}</div>\n                </div>\n              ))}\n            </div>\n          </Card>\n\n          <Card className=\"lg:col-span-2 bg-slate-800 border-slate-700 p-6\">\n            {isEditing ? (\n              <div className=\"space-y-4\">\n                <div>\n                  <Label className=\"text-white\">Template Name</Label>\n                  <Input value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} />\n                </div>\n                <div>\n                  <Label className=\"text-white\">Type</Label>\n                  <Select value={formData.template_type} onValueChange={(v) => setFormData({ ...formData, template_type: v })}>\n                    <SelectTrigger><SelectValue /></SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"welcome\">Welcome</SelectItem>\n                      <SelectItem value=\"password_reset\">Password Reset</SelectItem>\n                      <SelectItem value=\"order_confirmation\">Order Confirmation</SelectItem>\n                      <SelectItem value=\"trial_reminder\">Trial Reminder</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div>\n                  <Label className=\"text-white\">Subject</Label>\n                  <Input value={formData.subject} onChange={(e) => setFormData({ ...formData, subject: e.target.value })} />\n                </div>\n                <div>\n                  <Label className=\"text-white\">HTML Content</Label>\n                  <Textarea rows={8} value={formData.html_content} onChange={(e) => setFormData({ ...formData, html_content: e.target.value })} />\n                </div>\n                <div>\n                  <Label className=\"text-white\">Merge Tags (click to insert)</Label>\n                  <div className=\"flex flex-wrap gap-2 mt-2\">\n                    {mergeTags.map((tag) => (\n                      <button \n                        key={tag} \n                        onClick={() => insertMergeTag(tag)}\n                        className=\"px-2 py-1 bg-pale skin-600 text-white text-xs rounded hover:bg-pale skin-700 cursor-pointer\"\n                      >\n                        {tag}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button onClick={handleSave}>Save Template</Button>\n                  <Button variant=\"outline\" onClick={handleTestEmail}>Send Test Email</Button>\n                  <Button variant=\"outline\" onClick={() => setIsEditing(false)}>Cancel</Button>\n                </div>\n\n              </div>\n            ) : (\n              <div className=\"text-center text-slate-400 py-12\">Select or create a template</div>\n            )}\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["EmailTemplates","user","useAuth","templates","setTemplates","useState","selectedTemplate","setSelectedTemplate","isEditing","setIsEditing","formData","setFormData","useEffect","loadTemplates","data","supabase","handleSave","handleTestEmail","testContent","insertMergeTag","tag","handleEdit","template","mergeTags","jsxs","jsx","DashboardNav","Card","Button","Label","Input","e","Select","v","SelectTrigger","SelectValue","SelectContent","SelectItem","Textarea"],"mappings":"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"}