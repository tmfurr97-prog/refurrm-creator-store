import{j as e,ag as k,ah as P,r as j,l as U}from"./react-vendor-zXfd7Ve7.js";import{C as p,a as f,b as v,c as N,h as B,s as w,B as G}from"./index-k1V3dZSG.js";import{D as I}from"./DashboardNav-dXlKSIlC.js";import{S as F,a as $,b as R,c as S,d as b}from"./select-C3Vw_1bu.js";import"./vendor-BOHFvtXa.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";function H({data:o}){const g=Math.max(...o.map(a=>a.revenue));return e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-[#45b08c]"}),"Customer Segments"]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-4",children:o.map(a=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:a.segment}),e.jsxs("span",{className:"text-sm text-slate-600",children:[a.count," customers"]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("div",{className:"flex-1 h-8 bg-[#F5F5F5] rounded overflow-hidden",children:e.jsxs("div",{className:"h-full flex items-center px-2 text-white text-sm font-medium",style:{width:`${a.revenue/g*100}%`,backgroundColor:a.color,minWidth:"60px"},children:["$",a.revenue.toFixed(0)]})})})]},a.segment))})})]})}function W({data:o}){const g=o.reduce((a,i)=>a+i.revenue,0);return e.jsxs(p,{children:[e.jsx(f,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-[#35b5e6]"}),"Geographic Distribution"]})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-3",children:o.map((a,i)=>{const d=(a.revenue/g*100).toFixed(1),t=["#45b08c","#e88098","#35b5e6","#255d60","#F8DD50"];return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-32 text-sm font-medium truncate",children:a.location}),e.jsx("div",{className:"flex-1 h-6 bg-[#F5F5F5] rounded-full overflow-hidden",children:e.jsxs("div",{className:"h-full flex items-center justify-end px-2 text-white text-xs font-medium",style:{width:`${d}%`,backgroundColor:t[i%t.length],minWidth:d!=="0.0"?"50px":"0"},children:[d,"%"]})}),e.jsxs("div",{className:"w-20 text-sm text-slate-600 text-right",children:["$",a.revenue.toFixed(0)]})]},a.location)})})})]})}function z(){const[o,g]=j.useState("6"),a=[{month:"Jan 2025",customers:245,m0:100,m1:68,m2:52,m3:45,m4:41,m5:38,ltv:2850},{month:"Dec 2024",customers:198,m0:100,m1:72,m2:58,m3:49,m4:44,m5:40,ltv:3120},{month:"Nov 2024",customers:167,m0:100,m1:65,m2:48,m3:42,m4:38,m5:35,ltv:2640},{month:"Oct 2024",customers:223,m0:100,m1:70,m2:55,m3:47,m4:43,m5:39,ltv:2980},{month:"Sep 2024",customers:189,m0:100,m1:66,m2:50,m3:44,m4:40,m5:37,ltv:2720},{month:"Aug 2024",customers:201,m0:100,m1:69,m2:53,m3:46,m4:42,m5:38,ltv:2890}],i=t=>t>=70?"bg-[#45b08c]":t>=50?"bg-[#35b5e6]":t>=35?"bg-[#e88098]":"bg-[#255d60]",d=t=>t>=70?"opacity-100":t>=50?"opacity-80":t>=35?"opacity-60":"opacity-40";return e.jsxs(p,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between",children:[e.jsx(v,{children:"Cohort Retention Analysis"}),e.jsxs(F,{value:o,onValueChange:g,children:[e.jsx($,{className:"w-32",children:e.jsx(R,{})}),e.jsxs(S,{children:[e.jsx(b,{value:"3",children:"3 Months"}),e.jsx(b,{value:"6",children:"6 Months"}),e.jsx(b,{value:"12",children:"12 Months"})]})]})]}),e.jsxs(N,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-semibold",children:"Cohort"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Customers"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:"M0"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:"M1"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:"M2"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:"M3"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:"M4"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:"M5"}),e.jsx("th",{className:"text-right p-2 font-semibold",children:"Avg LTV"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-medium",children:t.month}),e.jsx("td",{className:"text-right p-2",children:t.customers}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:`${i(t.m0)} ${d(t.m0)} text-white text-center py-2 rounded`,children:[t.m0,"%"]})}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:`${i(t.m1)} ${d(t.m1)} text-white text-center py-2 rounded`,children:[t.m1,"%"]})}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:`${i(t.m2)} ${d(t.m2)} text-white text-center py-2 rounded`,children:[t.m2,"%"]})}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:`${i(t.m3)} ${d(t.m3)} text-white text-center py-2 rounded`,children:[t.m3,"%"]})}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:`${i(t.m4)} ${d(t.m4)} text-white text-center py-2 rounded`,children:[t.m4,"%"]})}),e.jsx("td",{className:"p-1",children:e.jsxs("div",{className:`${i(t.m5)} ${d(t.m5)} text-white text-center py-2 rounded`,children:[t.m5,"%"]})}),e.jsxs("td",{className:"text-right p-2 font-medium",children:["$",t.ltv.toLocaleString()]})]},t.month))})]})}),e.jsxs("div",{className:"mt-4 flex items-center gap-4 text-xs",children:[e.jsx("span",{className:"font-semibold",children:"Retention Legend:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-[#45b08c] rounded"}),e.jsx("span",{children:"70%+"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-[#35b5e6] rounded"}),e.jsx("span",{children:"50-69%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-[#e88098] rounded"}),e.jsx("span",{children:"35-49%"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-[#255d60] rounded"}),e.jsx("span",{children:"<35%"})]})]})]})]})}function se(){const{user:o}=B(),[g,a]=j.useState(!0),[i,d]=j.useState("30"),[t,D]=j.useState({}),[y,M]=j.useState([]),[L,q]=j.useState([]),[C,A]=j.useState([]);j.useEffect(()=>{O()},[o]);const O=async()=>{if(!o)return;const{data:h}=await w.from("shops").select("*").eq("user_id",o.id).single();if(!h){a(!1);return}const{data:l}=await w.from("orders").select("*").eq("shop_id",h.id).order("created_at",{ascending:!0}),{data:x}=await w.from("products").select("*").eq("shop_id",h.id);V(l||[]),a(!1)},V=h=>{const l=h.filter(s=>s.status==="completed"),x=l.reduce((s,r)=>s+parseFloat(r.amount),0),m=new Set(l.map(s=>s.customer_email)).size;D({totalRevenue:x,totalOrders:l.length,avgOrderValue:l.length?x/l.length:0,uniqueCustomers:m,clv:m>0?x/m:0,purchaseFrequency:m>0?l.length/m:0,retentionRate:75.5});const u={};l.forEach(s=>{u[s.customer_email]||(u[s.customer_email]=0),u[s.customer_email]+=parseFloat(s.amount)});const n=Object.values(u).map(s=>s),c=n.reduce((s,r)=>s+r,0)/n.length;M([{segment:"VIP Customers",count:n.filter(s=>s>c*2).length,revenue:n.filter(s=>s>c*2).reduce((s,r)=>s+r,0),color:"#45b08c"},{segment:"High Value",count:n.filter(s=>s>c&&s<=c*2).length,revenue:n.filter(s=>s>c&&s<=c*2).reduce((s,r)=>s+r,0),color:"#e88098"},{segment:"Regular",count:n.filter(s=>s>c*.5&&s<=c).length,revenue:n.filter(s=>s>c*.5&&s<=c).reduce((s,r)=>s+r,0),color:"#35b5e6"},{segment:"New/Low",count:n.filter(s=>s<=c*.5).length,revenue:n.filter(s=>s<=c*.5).reduce((s,r)=>s+r,0),color:"#255d60"}]),q([{location:"United States",customers:Math.floor(m*.45),revenue:x*.5},{location:"United Kingdom",customers:Math.floor(m*.2),revenue:x*.18},{location:"Canada",customers:Math.floor(m*.15),revenue:x*.14},{location:"Australia",customers:Math.floor(m*.1),revenue:x*.1},{location:"Other",customers:Math.floor(m*.1),revenue:x*.08}]);const _=Object.entries(u).map(([s,r])=>({email:s,revenue:r,orders:l.filter(E=>E.customer_email===s).length})).sort((s,r)=>r.revenue-s.revenue).slice(0,10);A(_)},T=()=>{const l=[["Customer Analytics Export"],[""],["Metric","Value"],["Total Revenue",`$${t.totalRevenue?.toFixed(2)}`],["Customer Lifetime Value",`$${t.clv?.toFixed(2)}`],["Purchase Frequency",`${t.purchaseFrequency?.toFixed(1)}x`],["Total Customers",t.uniqueCustomers],["Retention Rate",`${t.retentionRate}%`],[""],["Top Customers"],["Rank","Email","Orders","Revenue"],...C.map((n,c)=>[c+1,n.email,n.orders,`$${n.revenue.toFixed(2)}`]),[""],["Customer Segments"],["Segment","Count","Revenue"],...y.map(n=>[n.segment,n.count,`$${n.revenue.toFixed(2)}`])].map(n=>n.join(",")).join(`
`),x=new Blob([l],{type:"text/csv"}),m=window.URL.createObjectURL(x),u=document.createElement("a");u.href=m,u.download=`customer-analytics-${new Date().toISOString().split("T")[0]}.csv`,u.click()};return e.jsxs("div",{className:"flex min-h-screen bg-[#F5F5F5]",children:[e.jsx(I,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-[#255d60]",children:"Customer Analytics"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(F,{value:i,onValueChange:d,children:[e.jsx($,{className:"w-40",children:e.jsx(R,{})}),e.jsxs(S,{children:[e.jsx(b,{value:"7",children:"Last 7 days"}),e.jsx(b,{value:"30",children:"Last 30 days"}),e.jsx(b,{value:"90",children:"Last 90 days"}),e.jsx(b,{value:"365",children:"Last year"})]})]}),e.jsxs(G,{onClick:T,className:"bg-[#45b08c] hover:bg-[#3a9578]",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Export CSV"]})]})]}),g?e.jsx("p",{children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(p,{className:"border-l-4 border-[#45b08c]",children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Lifetime Value"})}),e.jsx(N,{children:e.jsxs("div",{className:"text-2xl font-bold text-[#255d60]",children:["$",t.clv?.toFixed(2)]})})]}),e.jsxs(p,{className:"border-l-4 border-[#e88098]",children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Purchase Frequency"})}),e.jsx(N,{children:e.jsxs("div",{className:"text-2xl font-bold text-[#255d60]",children:[t.purchaseFrequency?.toFixed(1),"x"]})})]}),e.jsxs(p,{className:"border-l-4 border-[#35b5e6]",children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Total Customers"})}),e.jsx(N,{children:e.jsx("div",{className:"text-2xl font-bold text-[#255d60]",children:t.uniqueCustomers})})]}),e.jsxs(p,{className:"border-l-4 border-[#F8DD50]",children:[e.jsx(f,{className:"pb-2",children:e.jsx(v,{className:"text-sm",children:"Retention Rate"})}),e.jsx(N,{children:e.jsxs("div",{className:"text-2xl font-bold text-[#255d60]",children:[t.retentionRate,"%"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(H,{data:y}),e.jsx(W,{data:L})]}),e.jsx("div",{className:"mb-6",children:e.jsx(z,{})}),e.jsxs(p,{children:[e.jsx(f,{children:e.jsx(v,{className:"text-[#255d60]",children:"Top Customers by Revenue"})}),e.jsx(N,{children:e.jsx("div",{className:"space-y-2",children:C.map((h,l)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-[#F5F5F5] rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#45b08c] text-white flex items-center justify-center font-bold",children:l+1}),e.jsx("span",{className:"font-medium",children:h.email})]}),e.jsxs("div",{className:"flex gap-6 text-sm",children:[e.jsxs("span",{className:"text-slate-600",children:[h.orders," orders"]}),e.jsxs("span",{className:"font-bold text-[#255d60]",children:["$",h.revenue.toFixed(2)]})]})]},l))})})]})]})]})})]})}export{se as default};
//# sourceMappingURL=Analytics-BIeOruBn.js.map
