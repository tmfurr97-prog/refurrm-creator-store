{"version":3,"file":"Health-B4fJgqNv.js","sources":["../../src/hooks/usePerformance.tsx","../../src/pages/Health.tsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { performanceMonitor } from '@/lib/performance';\n\nexport function usePageLoadTime(pageName: string) {\n  useEffect(() => {\n    const startTime = performance.now();\n    \n    return () => {\n      const duration = performance.now() - startTime;\n      performanceMonitor.logMetric({\n        type: 'page-load',\n        name: pageName,\n        duration,\n      });\n    };\n  }, [pageName]);\n}\n\nexport function useComponentRenderTime(componentName: string) {\n  const renderCount = useRef(0);\n  const startTime = useRef(performance.now());\n  \n  useEffect(() => {\n    renderCount.current++;\n    const duration = performance.now() - startTime.current;\n    \n    performanceMonitor.logMetric({\n      type: 'component-render',\n      name: componentName,\n      duration,\n      metadata: { renderCount: renderCount.current },\n    });\n    \n    startTime.current = performance.now();\n  });\n}\n\nexport async function measureApiCall<T>(\n  name: string,\n  apiCall: () => Promise<T>\n): Promise<T> {\n  const startTime = performance.now();\n  \n  try {\n    const result = await apiCall();\n    const duration = performance.now() - startTime;\n    \n    performanceMonitor.logMetric({\n      type: 'api-call',\n      name,\n      duration,\n      metadata: { success: true },\n    });\n    \n    return result;\n  } catch (error) {\n    const duration = performance.now() - startTime;\n    \n    performanceMonitor.logMetric({\n      type: 'error',\n      name,\n      duration,\n      error: error instanceof Error ? error.message : 'Unknown error',\n      metadata: { apiCall: true },\n    });\n    \n    throw error;\n  }\n}\n","import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { performanceMonitor } from '@/lib/performance';\nimport { usePageLoadTime } from '@/hooks/usePerformance';\n\n\nexport default function Health() {\n  usePageLoadTime('health-page');\n\n  const { user } = useAuth();\n  const [status, setStatus] = useState<any>({\n    connection: 'checking',\n    tables: [],\n    auth: 'checking',\n    errors: []\n  });\n\n  const checkHealth = async () => {\n    const errors: string[] = [];\n    let connection = 'disconnected';\n    let tables: string[] = [];\n\n    try {\n      // Test connection\n      const { data, error } = await supabase.from('products').select('count');\n      if (error) {\n        errors.push(`Products table: ${error.message}`);\n      } else {\n        connection = 'connected';\n      }\n\n      // Try to list tables\n      const tableTests = ['products', 'orders', 'subscriptions', 'affiliates', 'profiles'];\n      for (const table of tableTests) {\n        try {\n          const { error } = await supabase.from(table).select('*').limit(1);\n          if (!error) tables.push(table);\n        } catch (e) {\n          errors.push(`${table}: ${e}`);\n        }\n      }\n    } catch (e: any) {\n      errors.push(`Connection error: ${e.message}`);\n    }\n\n    setStatus({\n      connection,\n      tables,\n      auth: user ? 'authenticated' : 'anonymous',\n      errors,\n      supabaseUrl: import.meta.env.VITE_SUPABASE_URL || 'NOT SET',\n      timestamp: new Date().toISOString()\n    });\n  };\n\n  useEffect(() => {\n    checkHealth();\n  }, [user]);\n\n  return (\n    <div className=\"container mx-auto p-8 space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-3xl font-bold\">System Health Check</h1>\n        <Button onClick={checkHealth}>Refresh</Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Connection Status</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Badge variant={status.connection === 'connected' ? 'default' : 'destructive'}>\n            {status.connection}\n          </Badge>\n          <p className=\"mt-2 text-sm text-gray-600\">URL: {status.supabaseUrl}</p>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Authentication</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <Badge>{status.auth}</Badge>\n          {user && <p className=\"mt-2 text-sm\">User ID: {user.id}</p>}\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Available Tables ({status.tables.length})</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-2\">\n            {status.tables.map((table: string) => (\n              <Badge key={table} variant=\"outline\">{table}</Badge>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      {status.errors.length > 0 && (\n        <Card className=\"border-red-500\">\n          <CardHeader>\n            <CardTitle className=\"text-red-600\">Errors ({status.errors.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ul className=\"space-y-1 text-sm\">\n              {status.errors.map((err: string, i: number) => (\n                <li key={i} className=\"text-red-600\">{err}</li>\n              ))}\n            </ul>\n          </CardContent>\n        </Card>\n      )}\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Performance Metrics</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2 text-sm\">\n            <p>Total metrics tracked: {performanceMonitor.getMetrics().length}</p>\n            <p>API calls: {performanceMonitor.getMetricsByType('api-call').length}</p>\n            <p>Errors: {performanceMonitor.getMetricsByType('error').length}</p>\n            <p>Page loads: {performanceMonitor.getMetricsByType('page-load').length}</p>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={() => {\n                performanceMonitor.clearMetrics();\n                alert('Performance metrics cleared');\n              }}\n              className=\"mt-2\"\n            >\n              Clear Metrics\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n\n  );\n}\n"],"names":["usePageLoadTime","pageName","useEffect","startTime","duration","performanceMonitor","Health","user","useAuth","status","setStatus","useState","checkHealth","errors","connection","tables","data","error","supabase","tableTests","table","e","jsxs","Button","Card","jsx","CardHeader","CardTitle","CardContent","Badge","err","i"],"mappings":"mRAGO,SAASA,EAAgBC,EAAkB,CAChDC,EAAAA,UAAU,IAAM,CACd,MAAMC,EAAY,YAAY,IAAA,EAE9B,MAAO,IAAM,CACX,MAAMC,EAAW,YAAY,IAAA,EAAQD,EACrCE,EAAmB,UAAU,CAC3B,KAAM,YACN,KAAMJ,EACN,SAAAG,CAAA,CACD,CACH,CACF,EAAG,CAACH,CAAQ,CAAC,CACf,CCNA,SAAwBK,GAAS,CAC/BN,EAAgB,aAAa,EAE7B,KAAM,CAAE,KAAAO,CAAA,EAASC,EAAA,EACX,CAACC,EAAQC,CAAS,EAAIC,WAAc,CACxC,WAAY,WACZ,OAAQ,CAAA,EACR,KAAM,WACN,OAAQ,CAAA,CAAC,CACV,EAEKC,EAAc,SAAY,CAC9B,MAAMC,EAAmB,CAAA,EACzB,IAAIC,EAAa,eACbC,EAAmB,CAAA,EAEvB,GAAI,CAEF,KAAM,CAAE,KAAAC,EAAM,MAAAC,CAAA,EAAU,MAAMC,EAAS,KAAK,UAAU,EAAE,OAAO,OAAO,EAClED,EACFJ,EAAO,KAAK,mBAAmBI,EAAM,OAAO,EAAE,EAE9CH,EAAa,YAIf,MAAMK,EAAa,CAAC,WAAY,SAAU,gBAAiB,aAAc,UAAU,EACnF,UAAWC,KAASD,EAClB,GAAI,CACF,KAAM,CAAE,MAAAF,CAAAA,EAAU,MAAMC,EAAS,KAAKE,CAAK,EAAE,OAAO,GAAG,EAAE,MAAM,CAAC,EAC3DH,GAAOF,EAAO,KAAKK,CAAK,CAC/B,OAASC,EAAG,CACVR,EAAO,KAAK,GAAGO,CAAK,KAAKC,CAAC,EAAE,CAC9B,CAEJ,OAASA,EAAQ,CACfR,EAAO,KAAK,qBAAqBQ,EAAE,OAAO,EAAE,CAC9C,CAEAX,EAAU,CACR,WAAAI,EACA,OAAAC,EACA,KAAMR,EAAO,gBAAkB,YAC/B,OAAAM,EACA,YAAa,2CACb,UAAW,IAAI,KAAA,EAAO,YAAA,CAAY,CACnC,CACH,EAEAX,OAAAA,EAAAA,UAAU,IAAM,CACdU,EAAA,CACF,EAAG,CAACL,CAAI,CAAC,EAGPe,EAAAA,KAAC,MAAA,CAAI,UAAU,kCACb,SAAA,CAAAA,EAAAA,KAAC,MAAA,CAAI,UAAU,oCACb,SAAA,OAAC,KAAA,CAAG,UAAU,qBAAqB,SAAA,sBAAmB,QACrDC,EAAA,CAAO,QAASX,EAAa,SAAA,UAAO,CAAA,EACvC,SAECY,EAAA,CACC,SAAA,CAAAC,MAACC,EAAA,CACC,SAAAD,EAAAA,IAACE,EAAA,CAAU,SAAA,mBAAA,CAAiB,EAC9B,SACCC,EAAA,CACC,SAAA,CAAAH,EAAAA,IAACI,EAAA,CAAM,QAASpB,EAAO,aAAe,YAAc,UAAY,cAC7D,WAAO,UAAA,CACV,EACAa,EAAAA,KAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,CAAA,QAAMb,EAAO,WAAA,EAAY,CAAA,EACrE,CAAA,EACF,SAECe,EAAA,CACC,SAAA,CAAAC,MAACC,EAAA,CACC,SAAAD,EAAAA,IAACE,EAAA,CAAU,SAAA,gBAAA,CAAc,EAC3B,SACCC,EAAA,CACC,SAAA,OAACC,EAAA,CAAO,WAAO,KAAK,EACnBtB,GAAQe,EAAAA,KAAC,IAAA,CAAE,UAAU,eAAe,SAAA,CAAA,YAAUf,EAAK,EAAA,EAAG,CAAA,EACzD,CAAA,EACF,SAECiB,EAAA,CACC,SAAA,OAACE,EAAA,CACC,gBAACC,EAAA,CAAU,SAAA,CAAA,qBAAmBlB,EAAO,OAAO,OAAO,GAAA,CAAA,CAAC,CAAA,CACtD,QACCmB,EAAA,CACC,SAAAH,MAAC,OAAI,UAAU,uBACZ,WAAO,OAAO,IAAKL,GAClBK,EAAAA,IAACI,GAAkB,QAAQ,UAAW,YAA1BT,CAAgC,CAC7C,CAAA,CACH,CAAA,CACF,CAAA,EACF,EAECX,EAAO,OAAO,OAAS,UACrBe,EAAA,CAAK,UAAU,iBACd,SAAA,CAAAC,MAACC,EAAA,CACC,gBAACC,EAAA,CAAU,UAAU,eAAe,SAAA,CAAA,WAASlB,EAAO,OAAO,OAAO,GAAA,CAAA,CAAC,CAAA,CACrE,EACAgB,EAAAA,IAACG,GACC,SAAAH,EAAAA,IAAC,KAAA,CAAG,UAAU,oBACX,SAAAhB,EAAO,OAAO,IAAI,CAACqB,EAAaC,IAC/BN,EAAAA,IAAC,MAAW,UAAU,eAAgB,YAA7BM,CAAiC,CAC3C,CAAA,CACH,EACF,CAAA,EACF,SAGDP,EAAA,CACC,SAAA,CAAAC,MAACC,EAAA,CACC,SAAAD,EAAAA,IAACE,EAAA,CAAU,SAAA,qBAAA,CAAmB,EAChC,EACAF,MAACG,EAAA,CACC,gBAAC,MAAA,CAAI,UAAU,oBACb,SAAA,CAAAN,OAAC,IAAA,CAAE,SAAA,CAAA,0BAAwBjB,EAAmB,aAAa,MAAA,EAAO,SACjE,IAAA,CAAE,SAAA,CAAA,cAAYA,EAAmB,iBAAiB,UAAU,EAAE,MAAA,EAAO,SACrE,IAAA,CAAE,SAAA,CAAA,WAASA,EAAmB,iBAAiB,OAAO,EAAE,MAAA,EAAO,SAC/D,IAAA,CAAE,SAAA,CAAA,eAAaA,EAAmB,iBAAiB,WAAW,EAAE,MAAA,EAAO,EACxEoB,EAAAA,IAACF,EAAA,CACC,QAAQ,UACR,KAAK,KACL,QAAS,IAAM,CACblB,EAAmB,aAAA,EACnB,MAAM,6BAA6B,CACrC,EACA,UAAU,OACX,SAAA,eAAA,CAAA,CAED,CAAA,CACF,CAAA,CACF,CAAA,EACF,CAAA,EACF,CAGJ"}