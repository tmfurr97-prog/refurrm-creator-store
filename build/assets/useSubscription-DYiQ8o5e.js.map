{"version":3,"file":"useSubscription-DYiQ8o5e.js","sources":["../../src/hooks/useSubscription.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\n\nexport interface Subscription {\n  id: string;\n  status: string;\n  current_period_end: string;\n  product_id: string;\n  cancel_at_period_end: boolean;\n  tier: string;\n  is_trial: boolean;\n  trial_start_date: string | null;\n  trial_end_date: string | null;\n  trial_reminder_sent: boolean;\n  is_vip: boolean;\n}\n\n\n\nexport function useSubscription() {\n  const { user, testMode } = useAuth();\n  const [subscriptions, setSubscriptions] = useState<Subscription[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    if (!user) {\n      setSubscriptions([]);\n      setLoading(false);\n      return;\n    }\n\n    // If test mode is enabled, skip fetching and just set loading to false\n    if (testMode) {\n      setLoading(false);\n      return;\n    }\n\n    fetchSubscriptions();\n  }, [user, testMode]);\n\n\n  const fetchSubscriptions = async () => {\n    if (!user) return;\n\n    const { data, error } = await supabase\n      .from('subscriptions')\n      .select('*')\n      .eq('user_id', user.id)\n      .in('status', ['active', 'past_due']);\n\n\n    if (!error && data) {\n      setSubscriptions(data);\n    }\n    setLoading(false);\n  };\n\n  const hasActiveSubscription = (productId?: string) => {\n    // If test mode is enabled, always return true\n    if (testMode) return true;\n    \n    // VIP users always have access\n    if (subscriptions.some(sub => sub.is_vip)) return true;\n    \n    const activeStatuses = ['active', 'past_due'];\n\n    \n    if (productId) {\n      return subscriptions.some(\n        sub => sub.product_id === productId && activeStatuses.includes(sub.status)\n      );\n    }\n    \n    return subscriptions.some(sub => activeStatuses.includes(sub.status));\n  };\n\n  const hasAccessToProduct = (productId: string) => {\n    // If test mode is enabled, always return true\n    if (testMode) return true;\n    \n    // VIP users always have access\n    if (subscriptions.some(sub => sub.is_vip)) return true;\n    \n    return hasActiveSubscription(productId);\n  };\n\n  const isVip = () => {\n    return subscriptions.some(sub => sub.is_vip);\n  };\n\n\n  return {\n    subscriptions,\n    loading,\n    hasActiveSubscription,\n    hasAccessToProduct,\n    isVip,\n    refetch: fetchSubscriptions\n  };\n}\n\n"],"names":["useSubscription","user","testMode","useAuth","subscriptions","setSubscriptions","useState","loading","setLoading","useEffect","fetchSubscriptions","data","error","supabase","hasActiveSubscription","productId","sub","activeStatuses"],"mappings":"8FAoBO,SAASA,GAAkB,CAChC,KAAM,CAAE,KAAAC,EAAM,SAAAC,CAAA,EAAaC,EAAA,EACrB,CAACC,EAAeC,CAAgB,EAAIC,EAAAA,SAAyB,CAAA,CAAE,EAC/D,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAE3CG,EAAAA,UAAU,IAAM,CACd,GAAI,CAACR,EAAM,CACTI,EAAiB,CAAA,CAAE,EACnBG,EAAW,EAAK,EAChB,MACF,CAGA,GAAIN,EAAU,CACZM,EAAW,EAAK,EAChB,MACF,CAEAE,EAAA,CACF,EAAG,CAACT,EAAMC,CAAQ,CAAC,EAGnB,MAAMQ,EAAqB,SAAY,CACrC,GAAI,CAACT,EAAM,OAEX,KAAM,CAAE,KAAAU,EAAM,MAAAC,GAAU,MAAMC,EAC3B,KAAK,eAAe,EACpB,OAAO,GAAG,EACV,GAAG,UAAWZ,EAAK,EAAE,EACrB,GAAG,SAAU,CAAC,SAAU,UAAU,CAAC,EAGlC,CAACW,GAASD,GACZN,EAAiBM,CAAI,EAEvBH,EAAW,EAAK,CAClB,EAEMM,EAAyBC,GAAuB,CAKpD,GAHIb,GAGAE,EAAc,KAAKY,GAAOA,EAAI,MAAM,EAAG,MAAO,GAElD,MAAMC,EAAiB,CAAC,SAAU,UAAU,EAG5C,OAAIF,EACKX,EAAc,QACZY,EAAI,aAAeD,GAAaE,EAAe,SAASD,EAAI,MAAM,CAAA,EAItEZ,EAAc,KAAKY,GAAOC,EAAe,SAASD,EAAI,MAAM,CAAC,CACtE,EAiBA,MAAO,CACL,cAAAZ,EACA,QAAAG,EACA,sBAAAO,EACA,mBAnB0BC,GAEtBb,GAGAE,EAAc,KAAKY,GAAOA,EAAI,MAAM,EAAU,GAE3CF,EAAsBC,CAAS,EAatC,MAVY,IACLX,EAAc,KAAKY,GAAOA,EAAI,MAAM,EAU3C,QAASN,CAAA,CAEb"}