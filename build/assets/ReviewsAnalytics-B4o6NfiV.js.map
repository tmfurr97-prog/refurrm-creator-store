{"version":3,"file":"ReviewsAnalytics-B4o6NfiV.js","sources":["../../src/pages/ReviewsAnalytics.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Star, TrendingUp, MessageSquare, Award } from 'lucide-react';\nimport { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\n\nexport default function ReviewsAnalytics() {\n  const [stats, setStats] = useState({ avgRating: 0, totalReviews: 0, responseRate: 0, topReviewers: [] });\n  const [trendData, setTrendData] = useState<any[]>([]);\n  const [productRatings, setProductRatings] = useState<any[]>([]);\n\n  useEffect(() => {\n    loadAnalytics();\n  }, []);\n\n  const loadAnalytics = async () => {\n    const { data: reviews } = await supabase.from('product_reviews').select('*, products(name)');\n    \n    if (reviews) {\n      const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length || 0;\n      const responded = reviews.filter(r => r.admin_response).length;\n      const responseRate = (responded / reviews.length) * 100 || 0;\n\n      const reviewerCounts = reviews.reduce((acc: any, r) => {\n        acc[r.user_id] = (acc[r.user_id] || 0) + 1;\n        return acc;\n      }, {});\n      const topReviewers = Object.entries(reviewerCounts).sort((a: any, b: any) => b[1] - a[1]).slice(0, 5);\n\n      setStats({ avgRating, totalReviews: reviews.length, responseRate, topReviewers });\n\n      const last7Days = Array.from({ length: 7 }, (_, i) => {\n        const date = new Date();\n        date.setDate(date.getDate() - i);\n        return date.toISOString().split('T')[0];\n      }).reverse();\n\n      const trends = last7Days.map(date => ({\n        date,\n        reviews: reviews.filter(r => r.created_at.startsWith(date)).length,\n        avgRating: reviews.filter(r => r.created_at.startsWith(date)).reduce((sum, r) => sum + r.rating, 0) / reviews.filter(r => r.created_at.startsWith(date)).length || 0\n      }));\n      setTrendData(trends);\n\n      const productGroups = reviews.reduce((acc: any, r) => {\n        const productName = r.products?.name || 'Unknown';\n        if (!acc[productName]) acc[productName] = { name: productName, avgRating: 0, count: 0, total: 0 };\n        acc[productName].total += r.rating;\n        acc[productName].count += 1;\n        acc[productName].avgRating = acc[productName].total / acc[productName].count;\n        return acc;\n      }, {});\n      setProductRatings(Object.values(productGroups));\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <h1 className=\"text-3xl font-bold mb-6\">Reviews Analytics</h1>\n\n      <div className=\"grid md:grid-cols-4 gap-6 mb-6\">\n        <Card><CardHeader className=\"flex flex-row items-center justify-between pb-2\"><CardTitle className=\"text-sm font-medium\">Average Rating</CardTitle><Star className=\"h-4 w-4 text-yellow-500\" /></CardHeader><CardContent><div className=\"text-2xl font-bold\">{stats.avgRating.toFixed(1)}</div><p className=\"text-xs text-muted-foreground\">Out of 5.0</p></CardContent></Card>\n        <Card><CardHeader className=\"flex flex-row items-center justify-between pb-2\"><CardTitle className=\"text-sm font-medium\">Total Reviews</CardTitle><MessageSquare className=\"h-4 w-4\" /></CardHeader><CardContent><div className=\"text-2xl font-bold\">{stats.totalReviews}</div><p className=\"text-xs text-muted-foreground\">All time</p></CardContent></Card>\n        <Card><CardHeader className=\"flex flex-row items-center justify-between pb-2\"><CardTitle className=\"text-sm font-medium\">Response Rate</CardTitle><TrendingUp className=\"h-4 w-4\" /></CardHeader><CardContent><div className=\"text-2xl font-bold\">{stats.responseRate.toFixed(0)}%</div><p className=\"text-xs text-muted-foreground\">Admin responses</p></CardContent></Card>\n        <Card><CardHeader className=\"flex flex-row items-center justify-between pb-2\"><CardTitle className=\"text-sm font-medium\">Top Reviewers</CardTitle><Award className=\"h-4 w-4\" /></CardHeader><CardContent><div className=\"text-2xl font-bold\">{stats.topReviewers.length}</div><p className=\"text-xs text-muted-foreground\">Active contributors</p></CardContent></Card>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <Card><CardHeader><CardTitle>Review Trends</CardTitle></CardHeader><CardContent><ResponsiveContainer width=\"100%\" height={300}><LineChart data={trendData}><CartesianGrid strokeDasharray=\"3 3\" /><XAxis dataKey=\"date\" /><YAxis /><Tooltip /><Line type=\"monotone\" dataKey=\"reviews\" stroke=\"#8884d8\" /><Line type=\"monotone\" dataKey=\"avgRating\" stroke=\"#82ca9d\" /></LineChart></ResponsiveContainer></CardContent></Card>\n\n        <Card><CardHeader><CardTitle>Ratings by Product</CardTitle></CardHeader><CardContent><ResponsiveContainer width=\"100%\" height={300}><BarChart data={productRatings}><CartesianGrid strokeDasharray=\"3 3\" /><XAxis dataKey=\"name\" /><YAxis domain={[0, 5]} /><Tooltip /><Bar dataKey=\"avgRating\" fill=\"#fbbf24\" /></BarChart></ResponsiveContainer></CardContent></Card>\n      </div>\n    </div>\n  );\n}\n"],"names":["ReviewsAnalytics","stats","setStats","useState","trendData","setTrendData","productRatings","setProductRatings","useEffect","loadAnalytics","reviews","supabase","avgRating","sum","r","responseRate","reviewerCounts","acc","topReviewers","a","b","trends","_","i","date","productGroups","productName","jsxs","jsx","Card","CardHeader","CardTitle","Star","CardContent","MessageSquare","TrendingUp","Award","ResponsiveContainer","LineChart","CartesianGrid","XAxis","YAxis","Tooltip","Line","BarChart","Bar"],"mappings":"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"}