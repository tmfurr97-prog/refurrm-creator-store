{"version":3,"file":"Billing-Do9FFSxw.js","sources":["../../src/components/GracePeriodCountdown.tsx","../../src/pages/Billing.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { AlertTriangle } from 'lucide-react';\n\ninterface GracePeriodCountdownProps {\n  gracePeriodEnd: string;\n  onExpired?: () => void;\n}\n\nexport default function GracePeriodCountdown({ gracePeriodEnd, onExpired }: GracePeriodCountdownProps) {\n  const [timeLeft, setTimeLeft] = useState('');\n  const [isUrgent, setIsUrgent] = useState(false);\n\n  useEffect(() => {\n    const calculateTimeLeft = () => {\n      const end = new Date(gracePeriodEnd).getTime();\n      const now = Date.now();\n      const diff = end - now;\n\n      if (diff <= 0) {\n        setTimeLeft('Expired');\n        onExpired?.();\n        return;\n      }\n\n      const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n\n      setIsUrgent(days < 2);\n\n      if (days > 0) {\n        setTimeLeft(`${days}d ${hours}h`);\n      } else if (hours > 0) {\n        setTimeLeft(`${hours}h ${minutes}m`);\n      } else {\n        setTimeLeft(`${minutes}m`);\n      }\n    };\n\n    calculateTimeLeft();\n    const interval = setInterval(calculateTimeLeft, 60000);\n    return () => clearInterval(interval);\n  }, [gracePeriodEnd, onExpired]);\n\n  return (\n    <div className={`flex items-center gap-3 p-4 rounded-lg border-2 ${\n      isUrgent ? 'bg-red-50 border-red-300' : 'bg-yellow-50 border-yellow-300'\n    }`}>\n      <AlertTriangle className={`w-6 h-6 ${isUrgent ? 'text-red-600' : 'text-yellow-600'}`} />\n      <div>\n        <p className={`font-semibold ${isUrgent ? 'text-red-900' : 'text-yellow-900'}`}>\n          Grace Period: {timeLeft} remaining\n        </p>\n        <p className={`text-sm ${isUrgent ? 'text-red-700' : 'text-yellow-700'}`}>\n          Update your payment method to avoid service interruption\n        </p>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { useAuth } from '@/contexts/AuthContext';\nimport DashboardNav from '@/components/DashboardNav';\nimport GracePeriodCountdown from '@/components/GracePeriodCountdown';\n\nexport default function Billing() {\n  const { user, profile } = useAuth();\n  const [loading, setLoading] = useState(false);\n\n  const trialDaysLeft = profile?.trial_ends_at \n    ? Math.ceil((new Date(profile.trial_ends_at).getTime() - Date.now()) / (1000 * 60 * 60 * 24))\n    : 0;\n\n  const handleAddPayment = async () => {\n    setLoading(true);\n    // In production, create Stripe customer portal session\n    alert('Stripe customer portal will open here. You can update payment method, view invoices, and manage subscription.');\n    setLoading(false);\n  };\n\n  const handleCancelSubscription = async () => {\n    if (!confirm('Are you sure you want to cancel your subscription? You will lose access at the end of your billing period.')) {\n      return;\n    }\n\n    setLoading(true);\n    await supabase\n      .from('profiles')\n      .update({ subscription_status: 'canceled' })\n      .eq('id', user?.id);\n\n    alert('Subscription canceled. You will have access until the end of your billing period.');\n    setLoading(false);\n  };\n\n  const handleReactivate = async () => {\n    setLoading(true);\n    await supabase\n      .from('profiles')\n      .update({ subscription_status: 'active' })\n      .eq('id', user?.id);\n\n    alert('Subscription reactivated!');\n    setLoading(false);\n  };\n\n  return (\n    <div className=\"flex min-h-screen bg-slate-50\">\n      <DashboardNav />\n      \n      <div className=\"flex-1 p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <h2 className=\"text-3xl font-bold text-slate-900 mb-8\">Billing & Subscription</h2>\n\n          <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n            <h3 className=\"text-xl font-semibold text-slate-900 mb-4\">Current Plan</h3>\n            \n            <div className=\"flex justify-between items-center mb-6\">\n              <div>\n                <p className=\"text-2xl font-bold text-slate-900\">ReFurrm Shops Pro</p>\n                <p className=\"text-slate-600\">$29 per month</p>\n              </div>\n              <span className={`px-4 py-2 rounded text-sm font-semibold ${\n                profile?.subscription_status === 'trial' ? 'bg-blue-100 text-blue-700' :\n                profile?.subscription_status === 'active' ? 'bg-green-100 text-green-700' :\n                'bg-red-100 text-red-700'\n              }`}>\n                {profile?.subscription_status === 'trial' ? 'Free Trial' :\n                 profile?.subscription_status === 'active' ? 'Active' : 'Canceled'}\n              </span>\n            </div>\n\n            {profile?.subscription_status === 'trial' && trialDaysLeft > 0 && (\n              <div className=\"bg-pale skin-50 border border-pale skin-200 rounded-lg p-4 mb-6\">\n                <p className=\"text-pale skin-900\">\n                  <strong>{trialDaysLeft} days</strong> left in your free trial. \n                  Add a payment method to continue after your trial ends.\n                </p>\n              </div>\n            )}\n\n            {profile?.subscription_status === 'past_due' && profile?.grace_period_end && (\n              <div className=\"mb-6\">\n                <GracePeriodCountdown gracePeriodEnd={profile.grace_period_end} />\n              </div>\n            )}\n\n\n            <div className=\"space-y-3\">\n              <button\n                onClick={handleAddPayment}\n                disabled={loading}\n                className=\"w-full px-6 py-3 bg-pale skin-600 text-white rounded-lg font-semibold hover:bg-pale skin-700 transition disabled:opacity-50\"\n              >\n                {profile?.subscription_status === 'trial' ? 'Add Payment Method' : 'Update Payment Method'}\n              </button>\n\n              {profile?.subscription_status === 'active' && (\n                <button\n                  onClick={handleCancelSubscription}\n                  disabled={loading}\n                  className=\"w-full px-6 py-3 border-2 border-red-300 text-red-600 rounded-lg font-semibold hover:bg-red-50 transition disabled:opacity-50\"\n                >\n                  Cancel Subscription\n                </button>\n              )}\n\n              {profile?.subscription_status === 'canceled' && (\n                <button\n                  onClick={handleReactivate}\n                  disabled={loading}\n                  className=\"w-full px-6 py-3 bg-green-600 text-white rounded-lg font-semibold hover:bg-green-700 transition disabled:opacity-50\"\n                >\n                  Reactivate Subscription\n                </button>\n              )}\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h3 className=\"text-xl font-semibold text-slate-900 mb-4\">Plan Features</h3>\n            <ul className=\"space-y-3\">\n              <li className=\"flex items-center gap-3\">\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                </svg>\n                <span className=\"text-slate-700\">Unlimited products and courses</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                </svg>\n                <span className=\"text-slate-700\">AI-powered store setup and copywriting</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                </svg>\n                <span className=\"text-slate-700\">Advanced analytics and recommendations</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                </svg>\n                <span className=\"text-slate-700\">Email marketing and DM campaigns</span>\n              </li>\n              <li className=\"flex items-center gap-3\">\n                <svg className=\"w-5 h-5 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                </svg>\n                <span className=\"text-slate-700\">Booking and calendar management</span>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":["GracePeriodCountdown","gracePeriodEnd","onExpired","timeLeft","setTimeLeft","useState","isUrgent","setIsUrgent","useEffect","calculateTimeLeft","end","now","diff","days","hours","minutes","interval","jsx","AlertTriangle","jsxs","Billing","user","profile","useAuth","loading","setLoading","trialDaysLeft","handleAddPayment","handleCancelSubscription","supabase","handleReactivate","DashboardNav"],"mappings":"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"}