import{r as c,j as e,bN as S,M as _,a8 as K,bO as k}from"./react-vendor-zXfd7Ve7.js";import{s as O,C as n,a as i,b as l,c as d}from"./index-D8webL0o.js";import{R as x,L as E,H as m,X as h,Y as j,T as u,I as g,J as L,K as W}from"./vendor-BOHFvtXa.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";function U(){const[o,p]=c.useState({avgRating:0,totalReviews:0,responseRate:0,topReviewers:[]}),[f,v]=c.useState([]),[w,R]=c.useState([]);c.useEffect(()=>{N()},[]);const N=async()=>{const{data:r}=await O.from("product_reviews").select("*, products(name)");if(r){const b=r.reduce((s,t)=>s+t.rating,0)/r.length||0,y=r.filter(s=>s.admin_response).length/r.length*100||0,A=r.reduce((s,t)=>(s[t.user_id]=(s[t.user_id]||0)+1,s),{}),C=Object.entries(A).sort((s,t)=>t[1]-s[1]).slice(0,5);p({avgRating:b,totalReviews:r.length,responseRate:y,topReviewers:C});const D=Array.from({length:7},(s,t)=>{const a=new Date;return a.setDate(a.getDate()-t),a.toISOString().split("T")[0]}).reverse().map(s=>({date:s,reviews:r.filter(t=>t.created_at.startsWith(s)).length,avgRating:r.filter(t=>t.created_at.startsWith(s)).reduce((t,a)=>t+a.rating,0)/r.filter(t=>t.created_at.startsWith(s)).length||0}));v(D);const T=r.reduce((s,t)=>{const a=t.products?.name||"Unknown";return s[a]||(s[a]={name:a,avgRating:0,count:0,total:0}),s[a].total+=t.rating,s[a].count+=1,s[a].avgRating=s[a].total/s[a].count,s},{});R(Object.values(T))}};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Reviews Analytics"}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-6 mb-6",children:[e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Average Rating"}),e.jsx(S,{className:"h-4 w-4 text-yellow-500"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.avgRating.toFixed(1)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Out of 5.0"})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Total Reviews"}),e.jsx(_,{className:"h-4 w-4"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.totalReviews}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time"})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Response Rate"}),e.jsx(K,{className:"h-4 w-4"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[o.responseRate.toFixed(0),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Admin responses"})]})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:"Top Reviewers"}),e.jsx(k,{className:"h-4 w-4"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-2xl font-bold",children:o.topReviewers.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Active contributors"})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(n,{children:[e.jsx(i,{children:e.jsx(l,{children:"Review Trends"})}),e.jsx(d,{children:e.jsx(x,{width:"100%",height:300,children:e.jsxs(E,{data:f,children:[e.jsx(m,{strokeDasharray:"3 3"}),e.jsx(h,{dataKey:"date"}),e.jsx(j,{}),e.jsx(u,{}),e.jsx(g,{type:"monotone",dataKey:"reviews",stroke:"#8884d8"}),e.jsx(g,{type:"monotone",dataKey:"avgRating",stroke:"#82ca9d"})]})})})]}),e.jsxs(n,{children:[e.jsx(i,{children:e.jsx(l,{children:"Ratings by Product"})}),e.jsx(d,{children:e.jsx(x,{width:"100%",height:300,children:e.jsxs(L,{data:w,children:[e.jsx(m,{strokeDasharray:"3 3"}),e.jsx(h,{dataKey:"name"}),e.jsx(j,{domain:[0,5]}),e.jsx(u,{}),e.jsx(W,{dataKey:"avgRating",fill:"#fbbf24"})]})})})]})]})]})}export{U as default};
//# sourceMappingURL=ReviewsAnalytics-B4o6NfiV.js.map
