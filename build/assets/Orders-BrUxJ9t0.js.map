{"version":3,"file":"Orders-BrUxJ9t0.js","sources":["../../src/pages/Orders.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { Card } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Badge } from '@/components/ui/badge';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Label } from '@/components/ui/label';\nimport { useToast } from '@/hooks/use-toast';\nimport { Package, Search, Eye } from 'lucide-react';\n\nexport default function Orders() {\n  const [orders, setOrders] = useState<any[]>([]);\n  const [filteredOrders, setFilteredOrders] = useState<any[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [statusFilter, setStatusFilter] = useState('all');\n  const [selectedOrder, setSelectedOrder] = useState<any>(null);\n  const [trackingNumber, setTrackingNumber] = useState('');\n  const { toast } = useToast();\n\n  useEffect(() => {\n    loadOrders();\n  }, []);\n\n  useEffect(() => {\n    filterOrders();\n  }, [orders, searchTerm, statusFilter]);\n\n  const loadOrders = async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return;\n\n    const { data, error } = await supabase\n      .from('orders')\n      .select('*, order_items(*)')\n      .eq('user_id', user.id)\n      .order('created_at', { ascending: false });\n\n    if (!error && data) {\n      setOrders(data);\n    }\n    setLoading(false);\n  };\n\n  const filterOrders = () => {\n    let filtered = [...orders];\n    \n    if (statusFilter !== 'all') {\n      filtered = filtered.filter(o => o.fulfillment_status === statusFilter);\n    }\n    \n    if (searchTerm) {\n      filtered = filtered.filter(o => \n        o.order_number.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        o.customer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        o.customer_email.toLowerCase().includes(searchTerm.toLowerCase())\n      );\n    }\n    \n    setFilteredOrders(filtered);\n  };\n\n  const updateOrderStatus = async (orderId: string, status: string) => {\n    const { error } = await supabase\n      .from('orders')\n      .update({ fulfillment_status: status, updated_at: new Date().toISOString() })\n      .eq('id', orderId);\n\n    if (!error) {\n      toast({ title: 'Order status updated' });\n      loadOrders();\n    }\n  };\n\n  const fulfillOrder = async (order: any) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return;\n\n    const { data: integration } = await supabase\n      .from('integrations')\n      .select('*')\n      .eq('user_id', user.id)\n      .eq('type', 'printify')\n      .single();\n\n    if (!integration?.config?.shopId) {\n      toast({ title: 'Printify not connected', description: 'Please connect Printify in Integrations', variant: 'destructive' });\n      return;\n    }\n\n    const { data, error } = await supabase.functions.invoke('printful-order-fulfillment', {\n      body: {\n        orderId: order.order_number,\n        shopId: integration.config.shopId,\n        items: order.order_items,\n        shippingAddress: {\n          name: order.customer_name,\n          email: order.customer_email,\n          address1: order.shipping_address?.address1,\n          city: order.shipping_address?.city,\n          state: order.shipping_address?.state,\n          zip: order.shipping_address?.zip,\n          country: order.shipping_address?.country || 'US'\n        }\n      }\n    });\n\n    if (error) {\n      toast({ title: 'Fulfillment failed', description: error.message, variant: 'destructive' });\n    } else {\n      await supabase\n        .from('orders')\n        .update({ \n          fulfillment_status: 'processing',\n          printify_order_id: data.printifyOrderId\n        })\n        .eq('id', order.id);\n      \n      toast({ title: 'Order sent to Printify!' });\n      loadOrders();\n    }\n  };\n\n  const updateTracking = async () => {\n    if (!selectedOrder || !trackingNumber) return;\n\n    const { error } = await supabase\n      .from('orders')\n      .update({ \n        tracking_number: trackingNumber,\n        fulfillment_status: 'shipped',\n        updated_at: new Date().toISOString()\n      })\n      .eq('id', selectedOrder.id);\n\n    if (!error) {\n      toast({ title: 'Tracking number added' });\n      setSelectedOrder(null);\n      setTrackingNumber('');\n      loadOrders();\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: any = {\n      pending: 'secondary',\n      processing: 'default',\n      shipped: 'default',\n      delivered: 'default',\n      cancelled: 'destructive'\n    };\n    return colors[status] || 'secondary';\n  };\n\n  if (loading) return <div className=\"p-8\">Loading...</div>;\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <h1 className=\"text-3xl font-bold mb-8\">Orders</h1>\n\n      <div className=\"flex gap-4 mb-6\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-3 w-4 h-4 text-gray-400\" />\n          <Input\n            placeholder=\"Search orders...\"\n            value={searchTerm}\n            onChange={e => setSearchTerm(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        <Select value={statusFilter} onValueChange={setStatusFilter}>\n          <SelectTrigger className=\"w-48\">\n            <SelectValue />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\">All Orders</SelectItem>\n            <SelectItem value=\"pending\">Pending</SelectItem>\n            <SelectItem value=\"processing\">Processing</SelectItem>\n            <SelectItem value=\"shipped\">Shipped</SelectItem>\n            <SelectItem value=\"delivered\">Delivered</SelectItem>\n            <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"grid gap-4\">\n        {filteredOrders.map(order => (\n          <Card key={order.id} className=\"p-6\">\n            <div className=\"flex justify-between items-start mb-4\">\n              <div>\n                <h3 className=\"font-semibold text-lg\">Order #{order.order_number}</h3>\n                <p className=\"text-sm text-gray-500\">{order.customer_name || order.customer_email}</p>\n                <p className=\"text-xs text-gray-400\">{new Date(order.created_at).toLocaleDateString()}</p>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"text-2xl font-bold\">${order.total_amount}</p>\n                <Badge variant={getStatusColor(order.fulfillment_status)}>\n                  {order.fulfillment_status}\n                </Badge>\n              </div>\n            </div>\n\n            <div className=\"flex gap-2\">\n              {order.fulfillment_status === 'pending' && (\n                <Button size=\"sm\" onClick={() => fulfillOrder(order)}>\n                  <Package className=\"w-4 h-4 mr-2\" />\n                  Send to Printify\n                </Button>\n              )}\n              <Button size=\"sm\" variant=\"outline\" onClick={() => setSelectedOrder(order)}>\n                <Eye className=\"w-4 h-4 mr-2\" />\n                View Details\n              </Button>\n              <Select value={order.fulfillment_status} onValueChange={v => updateOrderStatus(order.id, v)}>\n                <SelectTrigger className=\"w-40\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"pending\">Pending</SelectItem>\n                  <SelectItem value=\"processing\">Processing</SelectItem>\n                  <SelectItem value=\"shipped\">Shipped</SelectItem>\n                  <SelectItem value=\"delivered\">Delivered</SelectItem>\n                  <SelectItem value=\"cancelled\">Cancelled</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n          </Card>\n        ))}\n      </div>\n\n      <Dialog open={!!selectedOrder} onOpenChange={() => setSelectedOrder(null)}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Order Details</DialogTitle>\n          </DialogHeader>\n          {selectedOrder && (\n            <div className=\"space-y-4\">\n              <div>\n                <h4 className=\"font-semibold mb-2\">Items</h4>\n                {selectedOrder.order_items?.map((item: any) => (\n                  <div key={item.id} className=\"flex justify-between py-2 border-b\">\n                    <span>{item.product_name} x {item.quantity}</span>\n                    <span>${item.subtotal}</span>\n                  </div>\n                ))}\n              </div>\n              <div>\n                <Label>Tracking Number</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={trackingNumber || selectedOrder.tracking_number || ''}\n                    onChange={e => setTrackingNumber(e.target.value)}\n                    placeholder=\"Enter tracking number\"\n                  />\n                  <Button onClick={updateTracking}>Save</Button>\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n"],"names":["Orders","orders","setOrders","useState","filteredOrders","setFilteredOrders","loading","setLoading","searchTerm","setSearchTerm","statusFilter","setStatusFilter","selectedOrder","setSelectedOrder","trackingNumber","setTrackingNumber","toast","useToast","useEffect","loadOrders","filterOrders","user","supabase","data","error","filtered","o","updateOrderStatus","orderId","status","fulfillOrder","order","integration","updateTracking","getStatusColor","jsx","jsxs","Search","Input","e","Select","SelectTrigger","SelectValue","SelectContent","SelectItem","Card","Badge","Button","Package","Eye","v","Dialog","DialogContent","DialogHeader","DialogTitle","item","Label"],"mappings":"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"}