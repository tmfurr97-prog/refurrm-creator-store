import{r as i,j as e,a5 as z,Q as B,J as F}from"./react-vendor-zXfd7Ve7.js";import{u as V,s as r,I as j,C as U,B as h,L as A}from"./index-k1V3dZSG.js";import{B as $}from"./badge-wcb6nnAT.js";import{S as v,a as _,b as S,c as b,d as a}from"./select-C3Vw_1bu.js";import{D as H,a as J,b as Q,c as R}from"./dialog-bS3FpGD2.js";import"./vendor-BOHFvtXa.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";function se(){const[f,y]=i.useState([]),[N,w]=i.useState([]),[C,O]=i.useState(!0),[l,k]=i.useState(""),[o,D]=i.useState("all"),[n,m]=i.useState(null),[p,x]=i.useState(""),{toast:c}=V();i.useEffect(()=>{u()},[]),i.useEffect(()=>{I()},[f,l,o]);const u=async()=>{const{data:{user:s}}=await r.auth.getUser();if(!s)return;const{data:t,error:d}=await r.from("orders").select("*, order_items(*)").eq("user_id",s.id).order("created_at",{ascending:!1});!d&&t&&y(t),O(!1)},I=()=>{let s=[...f];o!=="all"&&(s=s.filter(t=>t.fulfillment_status===o)),l&&(s=s.filter(t=>t.order_number.toLowerCase().includes(l.toLowerCase())||t.customer_name?.toLowerCase().includes(l.toLowerCase())||t.customer_email.toLowerCase().includes(l.toLowerCase()))),w(s)},L=async(s,t)=>{const{error:d}=await r.from("orders").update({fulfillment_status:t,updated_at:new Date().toISOString()}).eq("id",s);d||(c({title:"Order status updated"}),u())},P=async s=>{const{data:{user:t}}=await r.auth.getUser();if(!t)return;const{data:d}=await r.from("integrations").select("*").eq("user_id",t.id).eq("type","printify").single();if(!d?.config?.shopId){c({title:"Printify not connected",description:"Please connect Printify in Integrations",variant:"destructive"});return}const{data:E,error:g}=await r.functions.invoke("printful-order-fulfillment",{body:{orderId:s.order_number,shopId:d.config.shopId,items:s.order_items,shippingAddress:{name:s.customer_name,email:s.customer_email,address1:s.shipping_address?.address1,city:s.shipping_address?.city,state:s.shipping_address?.state,zip:s.shipping_address?.zip,country:s.shipping_address?.country||"US"}}});g?c({title:"Fulfillment failed",description:g.message,variant:"destructive"}):(await r.from("orders").update({fulfillment_status:"processing",printify_order_id:E.printifyOrderId}).eq("id",s.id),c({title:"Order sent to Printify!"}),u())},T=async()=>{if(!n||!p)return;const{error:s}=await r.from("orders").update({tracking_number:p,fulfillment_status:"shipped",updated_at:new Date().toISOString()}).eq("id",n.id);s||(c({title:"Tracking number added"}),m(null),x(""),u())},q=s=>({pending:"secondary",processing:"default",shipped:"default",delivered:"default",cancelled:"destructive"})[s]||"secondary";return C?e.jsx("div",{className:"p-8",children:"Loading..."}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Orders"}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(z,{className:"absolute left-3 top-3 w-4 h-4 text-gray-400"}),e.jsx(j,{placeholder:"Search orders...",value:l,onChange:s=>k(s.target.value),className:"pl-10"})]}),e.jsxs(v,{value:o,onValueChange:D,children:[e.jsx(_,{className:"w-48",children:e.jsx(S,{})}),e.jsxs(b,{children:[e.jsx(a,{value:"all",children:"All Orders"}),e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"processing",children:"Processing"}),e.jsx(a,{value:"shipped",children:"Shipped"}),e.jsx(a,{value:"delivered",children:"Delivered"}),e.jsx(a,{value:"cancelled",children:"Cancelled"})]})]})]}),e.jsx("div",{className:"grid gap-4",children:N.map(s=>e.jsxs(U,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["Order #",s.order_number]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.customer_name||s.customer_email}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-2xl font-bold",children:["$",s.total_amount]}),e.jsx($,{variant:q(s.fulfillment_status),children:s.fulfillment_status})]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.fulfillment_status==="pending"&&e.jsxs(h,{size:"sm",onClick:()=>P(s),children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Send to Printify"]}),e.jsxs(h,{size:"sm",variant:"outline",onClick:()=>m(s),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"View Details"]}),e.jsxs(v,{value:s.fulfillment_status,onValueChange:t=>L(s.id,t),children:[e.jsx(_,{className:"w-40",children:e.jsx(S,{})}),e.jsxs(b,{children:[e.jsx(a,{value:"pending",children:"Pending"}),e.jsx(a,{value:"processing",children:"Processing"}),e.jsx(a,{value:"shipped",children:"Shipped"}),e.jsx(a,{value:"delivered",children:"Delivered"}),e.jsx(a,{value:"cancelled",children:"Cancelled"})]})]})]})]},s.id))}),e.jsx(H,{open:!!n,onOpenChange:()=>m(null),children:e.jsxs(J,{className:"max-w-2xl",children:[e.jsx(Q,{children:e.jsx(R,{children:"Order Details"})}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Items"}),n.order_items?.map(s=>e.jsxs("div",{className:"flex justify-between py-2 border-b",children:[e.jsxs("span",{children:[s.product_name," x ",s.quantity]}),e.jsxs("span",{children:["$",s.subtotal]})]},s.id))]}),e.jsxs("div",{children:[e.jsx(A,{children:"Tracking Number"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{value:p||n.tracking_number||"",onChange:s=>x(s.target.value),placeholder:"Enter tracking number"}),e.jsx(h,{onClick:T,children:"Save"})]})]})]})]})})]})}export{se as default};
//# sourceMappingURL=Orders-DZddvwJu.js.map
