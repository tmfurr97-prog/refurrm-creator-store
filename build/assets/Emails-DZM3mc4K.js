import{r as t,j as e,o as y,L,k,m as E,n as D}from"./react-vendor-zXfd7Ve7.js";import{u as G,L as m,I as w,B as r,s as S,h as T,b as N,C as A,a as I,c as B}from"./index-D8webL0o.js";import{D as _}from"./DashboardNav-ZSGo2elE.js";import{B as F}from"./badge-C_-9dwWz.js";import{R}from"./RichTextEditor-BDX5KtVu.js";import{D as P,a as z,b as H,c as $,d as q}from"./dialog-CZrj50f4.js";import{S as U,a as V,b as M,c as O,d as b}from"./select-BG5THQer.js";import"./vendor-BOHFvtXa.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";import"./markdown-B2p_DnqW.js";function J({open:u,onClose:n,onApply:f}){const[p,g]=t.useState(!1),[i,j]=t.useState(null),[a,c]=t.useState({goal:"",productName:"",tone:"professional"}),[o,x]=t.useState(null),{toast:d}=G(),h=(s,l)=>{navigator.clipboard.writeText(s),x(l),d({title:"Copied to clipboard!"}),setTimeout(()=>x(null),2e3)},v=async()=>{if(!a.goal||!a.productName){d({title:"Please fill all fields",variant:"destructive"});return}g(!0);try{const{data:s,error:l}=await S.functions.invoke("ai-email-generator",{body:a});if(l)throw l;j(s),d({title:"Email campaign generated!",description:"Review and use your content"})}catch{d({title:"Generation failed",description:"Please try again",variant:"destructive"})}finally{g(!1)}},C=()=>{j(null),c({goal:"",productName:"",tone:"professional"})};return e.jsx(P,{open:u,onOpenChange:n,children:e.jsxs(z,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-[#C24C1A]"}),"AI Email Generator"]}),e.jsx(q,{children:"Generate professional email campaigns with AI-powered copywriting"})]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(r,{onClick:C,variant:"outline",size:"sm",children:[e.jsx(k,{className:"h-4 w-4 mr-2"})," Generate New"]})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold",children:"Subject Lines"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Choose the one that resonates best"}),e.jsx("div",{className:"space-y-2",children:i.subjectLines?.map((s,l)=>e.jsxs("div",{className:"p-3 bg-[#EDDACE]/50 border border-[#C24C1A]/30 rounded flex items-center justify-between group hover:shadow-md transition-shadow",children:[e.jsx("span",{className:"text-sm font-medium text-[#5C4033]",children:s}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>h(s,`subject-${l}`),children:o===`subject-${l}`?e.jsx(E,{className:"h-4 w-4 text-[#1E8D70]"}):e.jsx(D,{className:"h-4 w-4"})})]},l))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{className:"text-base font-semibold",children:"Email Body"}),e.jsx(r,{size:"sm",variant:"ghost",onClick:()=>h(i.emailBody?.replace(/<[^>]*>/g,""),"body"),children:o==="body"?e.jsx(E,{className:"h-4 w-4 text-[#1E8D70]"}):e.jsx(D,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-4 bg-white rounded border text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:i.emailBody}})]}),e.jsx(r,{onClick:()=>{f(i),n()},className:"w-full bg-[#C24C1A] hover:bg-[#A63D14]",children:"Use This Email"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"goal",children:"Campaign Goal"}),e.jsx(w,{id:"goal",value:a.goal,onChange:s=>c({...a,goal:s.target.value}),placeholder:"E.g., Launch new course, Promote sale, Build engagement"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"product",children:"Product/Service Name"}),e.jsx(w,{id:"product",value:a.productName,onChange:s=>c({...a,productName:s.target.value}),placeholder:"E.g., Instagram Growth Course"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"tone",children:"Tone"}),e.jsxs(U,{value:a.tone,onValueChange:s=>c({...a,tone:s}),children:[e.jsx(V,{children:e.jsx(M,{})}),e.jsxs(O,{children:[e.jsx(b,{value:"professional",children:"Professional"}),e.jsx(b,{value:"casual",children:"Casual & Friendly"}),e.jsx(b,{value:"urgent",children:"Urgent & Direct"}),e.jsx(b,{value:"inspirational",children:"Inspirational"})]})]})]}),e.jsx(r,{onClick:v,disabled:p,className:"w-full bg-[#C24C1A] hover:bg-[#A63D14]",children:p?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"mr-2 h-4 w-4"}),"Generate Email"]})})]})]})})}function ie(){const{user:u}=T(),[n,f]=t.useState([]),[p,g]=t.useState(!0),[i,j]=t.useState(!1),[a,c]=t.useState(!1),[o,x]=t.useState({subject:"",body:""}),[d,h]=t.useState("");t.useEffect(()=>{v()},[u]);const v=async()=>{if(!u)return;const{data:s}=await S.from("shops").select("id").eq("user_id",u.id).single();if(s){const{data:l}=await S.from("email_subscribers").select("*").eq("shop_id",s.id).order("subscribed_at",{ascending:!1});f(l||[])}g(!1)},C=async()=>{if(!o.subject||!d){alert("Please fill in subject and body");return}alert(`Email broadcast sent to ${n.length} subscribers!`),j(!1),x({subject:"",body:""}),h("")};return e.jsxs("div",{className:"flex min-h-screen bg-slate-50",children:[e.jsx(_,{}),e.jsxs("div",{className:"flex-1 p-8",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx(N,{className:"text-3xl",children:"Email Subscribers"}),e.jsx(r,{onClick:()=>j(!i),children:i?"Cancel":"Send Broadcast"})]}),i&&e.jsxs(A,{className:"mb-6",children:[e.jsx(I,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(N,{children:"Compose Email"}),e.jsxs(r,{onClick:()=>c(!0),variant:"outline",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),"AI Generate"]})]})}),e.jsx(B,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Subject"}),e.jsx(w,{type:"text",value:o.subject,onChange:s=>x({...o,subject:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Body"}),e.jsx(R,{value:d,onChange:h})]}),e.jsxs(r,{onClick:C,children:["Send to ",n.length," Subscribers"]})]})})]}),p?e.jsx("p",{className:"text-slate-600",children:"Loading subscribers..."}):e.jsxs(A,{children:[e.jsxs(I,{children:[e.jsxs(N,{children:[n.length," total subscribers"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:[n.filter(s=>s.is_buyer).length," buyers"]})]}),e.jsx(B,{children:e.jsx("div",{className:"divide-y divide-slate-200",children:n.map(s=>e.jsxs("div",{className:"py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.email}),s.name&&e.jsx("p",{className:"text-sm text-slate-600",children:s.name})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[s.is_buyer&&e.jsx(F,{variant:"secondary",children:"Buyer"}),e.jsx("span",{className:"text-sm text-slate-500",children:new Date(s.subscribed_at).toLocaleDateString()})]})]},s.id))})})]})]}),e.jsx(J,{open:a,onClose:()=>c(!1),onApply:s=>{x({...o,subject:s.subjectLines?.[0]||""}),h(s.emailBody||"")}})]})]})}export{ie as default};
//# sourceMappingURL=Emails-DZM3mc4K.js.map
