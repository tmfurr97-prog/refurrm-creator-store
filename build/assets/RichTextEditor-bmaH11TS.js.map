{"version":3,"file":"RichTextEditor-bmaH11TS.js","sources":["../../src/components/RichTextEditor.tsx"],"sourcesContent":["import { useRef, useState } from 'react';\nimport { marked } from 'marked';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Button } from '@/components/ui/button';\nimport { Bold, Italic, List, Link, Image, Code } from 'lucide-react';\n\ninterface RichTextEditorProps {\n  value: string;\n  onChange: (value: string) => void;\n  onImageUpload?: (file?: File) => Promise<string | void> | string | void;\n}\n\nexport function RichTextEditor({ value, onChange, onImageUpload }: RichTextEditorProps) {\n  const [preview, setPreview] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement | null>(null);\n\n  const insertMarkdown = (before: string, after = '') => {\n    const textarea = textareaRef.current;\n    if (!textarea) return;\n\n    const currentValue = textarea.value;\n    const start = textarea.selectionStart ?? currentValue.length;\n    const end = textarea.selectionEnd ?? currentValue.length;\n    const selectedText = currentValue.substring(start, end) || 'text';\n\n    const newText =\n      currentValue.substring(0, start) +\n      before +\n      selectedText +\n      after +\n      currentValue.substring(end);\n\n    onChange(newText);\n\n    requestAnimationFrame(() => {\n      const cursorStart = start + before.length;\n      const cursorEnd = cursorStart + selectedText.length;\n      textarea.focus();\n      textarea.setSelectionRange(cursorStart, cursorEnd);\n    });\n  };\n\n  const handleImageUpload = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = 'image/*';\n    input.onchange = async () => {\n      const file = input.files?.[0];\n      if (!file) return;\n\n      let imageUrl: string | undefined;\n      if (onImageUpload) {\n        const result = await onImageUpload(file);\n        if (typeof result === 'string') {\n          imageUrl = result;\n        }\n      }\n\n      if (imageUrl) {\n        insertMarkdown(`![${file.name}](${imageUrl})`);\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        if (typeof reader.result === 'string') {\n          insertMarkdown(`![${file.name}](${reader.result})`);\n        }\n      };\n      reader.readAsDataURL(file);\n    };\n    input.click();\n  };\n\n  const handleLinkInsert = () => {\n    const url = window.prompt('Enter URL');\n    if (!url) return;\n    insertMarkdown('[', `](${url})`);\n  };\n\n  const renderPreview = () => {\n    const html = marked.parse(value || '');\n    if (typeof html !== 'string') {\n      return <p className=\"text-slate-400\">Preview is loading...</p>;\n    }\n    return <div className=\"prose prose-slate max-w-none\" dangerouslySetInnerHTML={{ __html: html }} />;\n  };\n\n  return (\n    <div className=\"rounded-md border border-slate-200 bg-white\">\n      <div className=\"flex flex-wrap items-center gap-1 border-b border-slate-200 bg-slate-50/80 p-2\">\n        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={() => insertMarkdown('**', '**')} aria-label=\"Bold\">\n          <Bold className=\"h-4 w-4\" />\n        </Button>\n        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={() => insertMarkdown('*', '*')} aria-label=\"Italic\">\n          <Italic className=\"h-4 w-4\" />\n        </Button>\n        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={() => insertMarkdown('\\n- ', '')} aria-label=\"List\">\n          <List className=\"h-4 w-4\" />\n        </Button>\n        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={handleLinkInsert} aria-label=\"Link\">\n          <Link className=\"h-4 w-4\" />\n        </Button>\n        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={handleImageUpload} aria-label=\"Image\">\n          <Image className=\"h-4 w-4\" />\n        </Button>\n        <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={() => insertMarkdown('`', '`')} aria-label=\"Code\">\n          <Code className=\"h-4 w-4\" />\n        </Button>\n        <div className=\"ml-auto flex items-center gap-1\">\n          <Button type=\"button\" variant={!preview ? 'secondary' : 'ghost'} size=\"sm\" onClick={() => setPreview(false)}>\n            Edit\n          </Button>\n          <Button type=\"button\" variant={preview ? 'secondary' : 'ghost'} size=\"sm\" onClick={() => setPreview(true)}>\n            Preview\n          </Button>\n        </div>\n      </div>\n      {preview ? (\n        <div className=\"min-h-[160px] p-3 text-sm\">\n          {value ? renderPreview() : <p className=\"text-slate-400\">Nothing to preview yet.</p>}\n        </div>\n      ) : (\n        <Textarea\n          ref={textareaRef}\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          rows={10}\n          className=\"min-h-[160px] rounded-none border-0 focus-visible:ring-0 focus-visible:border-transparent\"\n        />\n      )}\n    </div>\n  );\n}\n\nexport default RichTextEditor;\n"],"names":["RichTextEditor","value","onChange","onImageUpload","preview","setPreview","useState","textareaRef","useRef","insertMarkdown","before","after","textarea","currentValue","start","end","selectedText","newText","cursorStart","cursorEnd","handleImageUpload","input","file","imageUrl","result","reader","handleLinkInsert","url","renderPreview","html","marked","jsx","jsxs","Button","Bold","Italic","List","Link","Image","Code","Textarea","e"],"mappings":"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"}