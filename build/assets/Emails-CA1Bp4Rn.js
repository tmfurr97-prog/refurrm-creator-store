import{r as t,j as e,o as w,L as k,k as G,m as E,n as I}from"./react-vendor-zXfd7Ve7.js";import{u as T,L as m,I as C,B as n,s as S,h as _,b as y,C as B,a as D,c as L}from"./index-k1V3dZSG.js";import{D as A}from"./DashboardNav-dXlKSIlC.js";import{B as F}from"./badge-wcb6nnAT.js";import{R}from"./RichTextEditor-bmaH11TS.js";import{D as P,a as z,b as H,c as $,d as q}from"./dialog-bS3FpGD2.js";import{S as U,a as V,b as M,c as O,d as b}from"./select-C3Vw_1bu.js";import"./vendor-BOHFvtXa.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";import"./markdown-B2p_DnqW.js";function J({open:u,onClose:r,onApply:f}){const[p,g]=t.useState(!1),[i,j]=t.useState(null),[a,o]=t.useState({goal:"",productName:"",tone:"professional"}),[c,h]=t.useState(null),{toast:d}=T(),x=(s,l)=>{navigator.clipboard.writeText(s),h(l),d({title:"Copied to clipboard!"}),setTimeout(()=>h(null),2e3)},v=async()=>{if(!a.goal||!a.productName){d({title:"Please fill all fields",variant:"destructive"});return}g(!0);try{const{data:s,error:l}=await S.functions.invoke("ai-email-generator",{body:a});if(l)throw l;j(s),d({title:"Email campaign generated!",description:"Review and use your content"})}catch{d({title:"Generation failed",description:"Please try again",variant:"destructive"})}finally{g(!1)}},N=()=>{j(null),o({goal:"",productName:"",tone:"professional"})};return e.jsx(P,{open:u,onOpenChange:r,children:e.jsxs(z,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-purple-600"}),"AI Email Generator"]}),e.jsx(q,{children:"Generate professional email campaigns with AI-powered copywriting"})]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(n,{onClick:N,variant:"outline",size:"sm",children:[e.jsx(G,{className:"h-4 w-4 mr-2"})," Generate New"]})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-base font-semibold",children:"Subject Lines"}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Choose the one that resonates best"}),e.jsx("div",{className:"space-y-2",children:i.subjectLines?.map((s,l)=>e.jsxs("div",{className:"p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded border flex items-center justify-between group hover:shadow-md transition-shadow",children:[e.jsx("span",{className:"text-sm font-medium",children:s}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>x(s,`subject-${l}`),children:c===`subject-${l}`?e.jsx(E,{className:"h-4 w-4 text-green-600"}):e.jsx(I,{className:"h-4 w-4"})})]},l))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{className:"text-base font-semibold",children:"Email Body"}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>x(i.emailBody?.replace(/<[^>]*>/g,""),"body"),children:c==="body"?e.jsx(E,{className:"h-4 w-4 text-green-600"}):e.jsx(I,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"p-4 bg-white rounded border text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:i.emailBody}})]}),e.jsx(n,{onClick:()=>{f(i),r()},className:"w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:"Use This Email"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"goal",children:"Campaign Goal"}),e.jsx(C,{id:"goal",value:a.goal,onChange:s=>o({...a,goal:s.target.value}),placeholder:"E.g., Launch new course, Promote sale, Build engagement"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"product",children:"Product/Service Name"}),e.jsx(C,{id:"product",value:a.productName,onChange:s=>o({...a,productName:s.target.value}),placeholder:"E.g., Instagram Growth Course"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"tone",children:"Tone"}),e.jsxs(U,{value:a.tone,onValueChange:s=>o({...a,tone:s}),children:[e.jsx(V,{children:e.jsx(M,{})}),e.jsxs(O,{children:[e.jsx(b,{value:"professional",children:"Professional"}),e.jsx(b,{value:"casual",children:"Casual & Friendly"}),e.jsx(b,{value:"urgent",children:"Urgent & Direct"}),e.jsx(b,{value:"inspirational",children:"Inspirational"})]})]})]}),e.jsx(n,{onClick:v,disabled:p,className:"w-full bg-purple-600 hover:bg-purple-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),"Generate Email"]})})]})]})})}function ie(){const{user:u}=_(),[r,f]=t.useState([]),[p,g]=t.useState(!0),[i,j]=t.useState(!1),[a,o]=t.useState(!1),[c,h]=t.useState({subject:"",body:""}),[d,x]=t.useState("");t.useEffect(()=>{v()},[u]);const v=async()=>{if(!u)return;const{data:s}=await S.from("shops").select("id").eq("user_id",u.id).single();if(s){const{data:l}=await S.from("email_subscribers").select("*").eq("shop_id",s.id).order("subscribed_at",{ascending:!1});f(l||[])}g(!1)},N=async()=>{if(!c.subject||!d){alert("Please fill in subject and body");return}alert(`Email broadcast sent to ${r.length} subscribers!`),j(!1),h({subject:"",body:""}),x("")};return e.jsxs("div",{className:"flex min-h-screen bg-slate-50",children:[e.jsx(A,{}),e.jsxs("div",{className:"flex-1 p-8",children:[e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx(y,{className:"text-3xl",children:"Email Subscribers"}),e.jsx(n,{onClick:()=>j(!i),children:i?"Cancel":"Send Broadcast"})]}),i&&e.jsxs(B,{className:"mb-6",children:[e.jsx(D,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(y,{children:"Compose Email"}),e.jsxs(n,{onClick:()=>o(!0),variant:"outline",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"AI Generate"]})]})}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Subject"}),e.jsx(C,{type:"text",value:c.subject,onChange:s=>h({...c,subject:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Body"}),e.jsx(R,{value:d,onChange:x})]}),e.jsxs(n,{onClick:N,children:["Send to ",r.length," Subscribers"]})]})})]}),p?e.jsx("p",{className:"text-slate-600",children:"Loading subscribers..."}):e.jsxs(B,{children:[e.jsxs(D,{children:[e.jsxs(y,{children:[r.length," total subscribers"]}),e.jsxs("p",{className:"text-sm text-slate-600",children:[r.filter(s=>s.is_buyer).length," buyers"]})]}),e.jsx(L,{children:e.jsx("div",{className:"divide-y divide-slate-200",children:r.map(s=>e.jsxs("div",{className:"py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.email}),s.name&&e.jsx("p",{className:"text-sm text-slate-600",children:s.name})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[s.is_buyer&&e.jsx(F,{variant:"secondary",children:"Buyer"}),e.jsx("span",{className:"text-sm text-slate-500",children:new Date(s.subscribed_at).toLocaleDateString()})]})]},s.id))})})]})]}),e.jsx(J,{open:a,onClose:()=>o(!1),onApply:s=>{h({...c,subject:s.subjectLines?.[0]||""}),x(s.emailBody||"")}})]})]})}export{ie as default};
//# sourceMappingURL=Emails-CA1Bp4Rn.js.map
