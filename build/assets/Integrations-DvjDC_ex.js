import{r as a,j as e,Q as E,ai as D,k as $,aj as G,a8 as K,ak as V,o as W,x as z,$ as Q,al as M}from"./react-vendor-zXfd7Ve7.js";import{u as X,s as r,C,B as y,L as v,I as S,T as H,h as B}from"./index-k1V3dZSG.js";import{D as J}from"./DashboardNav-dXlKSIlC.js";import{S as T,a as U,b as F,c as q,d as w}from"./select-C3Vw_1bu.js";import{B as Y}from"./badge-wcb6nnAT.js";import{S as Z}from"./switch-IuCVSr7H.js";import{G as N}from"./vendor-BOHFvtXa.js";import{T as ee,a as se,b as L,c as A}from"./tabs-DyFoJc2q.js";import"./ui-vendor-BrpyYz2q.js";import"./supabase-CH0YqYdn.js";function te(){const[l,d]=a.useState([]),[u,f]=a.useState(""),[h,x]=a.useState(!1),[m,g]=a.useState(!1),{toast:t}=X();a.useEffect(()=>{o(),p()},[]);const o=async()=>{x(!0);const{data:s,error:i}=await r.functions.invoke("printify-get-shops");i?t({title:"Error loading shops",description:i.message,variant:"destructive"}):s?.shops&&d(s.shops),x(!1)},p=async()=>{const{data:{user:s}}=await r.auth.getUser();if(!s)return;const{data:i}=await r.from("integrations").select("*").eq("user_id",s.id).eq("type","printify").single();i&&(g(!0),f(i.config?.shopId))},j=async()=>{const{data:{user:s}}=await r.auth.getUser();if(!s||!u)return;const{error:i}=await r.from("integrations").upsert({user_id:s.id,type:"printify",config:{shopId:u},connected:!0});i?t({title:"Error",description:i.message,variant:"destructive"}):(g(!0),t({title:"Printify connected successfully!"}))};return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Printify Integration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatic order fulfillment"})]})]}),m&&e.jsxs(Y,{variant:"default",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Connected"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Printify Shop"}),e.jsxs(T,{value:u,onValueChange:f,children:[e.jsx(U,{children:e.jsx(F,{placeholder:"Choose a shop..."})}),e.jsx(q,{children:l.map(s=>e.jsx(w,{value:s.id.toString(),children:s.title},s.id))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:j,disabled:!u||h,children:m?"Update Connection":"Connect"}),e.jsxs(y,{variant:"outline",onClick:o,disabled:h,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Refresh Shops"]})]})]})]})}function ae(){const[l,d]=a.useState(""),[u,f]=a.useState(""),[h,x]=a.useState(""),m=()=>{const o=parseFloat(l)||0,p=parseFloat(u)||0,j=parseFloat(h)||0,s=p-o-j,i=p>0?s/p*100:0;return{profit:s,margin:i}},{profit:g,margin:t}=m();return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(G,{className:"w-6 h-6 text-blue-600"}),e.jsx("h3",{className:"text-xl font-bold",children:"Profit Margin Calculator"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{children:"Product Cost (from Printify)"}),e.jsx(S,{type:"number",step:"0.01",value:l,onChange:o=>d(o.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Selling Price"}),e.jsx(S,{type:"number",step:"0.01",value:u,onChange:o=>f(o.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(v,{children:"Shipping Cost"}),e.jsx(S,{type:"number",step:"0.01",value:h,onChange:o=>x(o.target.value),placeholder:"0.00"})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Net Profit"}),e.jsxs("span",{className:`text-2xl font-bold ${g>=0?"text-green-600":"text-red-600"}`,children:["$",g.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Profit Margin"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{className:"text-xl font-semibold",children:[t.toFixed(1),"%"]})]})]})]})]})]})}function ne(){const[l,d]=a.useState(""),[u,f]=a.useState(30),[h,x]=a.useState(!1),[m,g]=a.useState(""),[t,o]=a.useState(!1);a.useEffect(()=>{p();const s=window.location.origin.includes("localhost")?"https://api.databasepad.com":window.location.origin;g(`${s}/functions/v1/printful-webhook-handler`)},[]);const p=async()=>{const{data:{user:s}}=await r.auth.getUser();if(!s)return;const{data:i}=await r.from("printful_settings").select("*").eq("user_id",s.id).single();i&&(d(i.api_key||""),f(i.default_profit_margin||30),x(i.auto_fulfill||!1))},j=async()=>{o(!0);try{const{data:{user:s}}=await r.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:i}=await r.from("printful_settings").upsert({user_id:s.id,api_key:l,default_profit_margin:u,auto_fulfill:h,updated_at:new Date().toISOString()});if(i)throw i;N.success("Printful settings saved!")}catch(s){N.error(s.message)}finally{o(!1)}};return e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(E,{className:"w-6 h-6 text-primary"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Printful Integration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"apiKey",children:"Printful API Key"}),e.jsx(S,{id:"apiKey",type:"password",value:l,onChange:s=>d(s.target.value),placeholder:"Enter your Printful API key"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"profitMargin",children:"Default Profit Margin (%)"}),e.jsx(S,{id:"profitMargin",type:"number",value:u,onChange:s=>f(Number(s.target.value)),min:"0",max:"100"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{htmlFor:"autoFulfill",children:"Auto-fulfill orders"}),e.jsx(Z,{id:"autoFulfill",checked:h,onCheckedChange:x})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx(v,{children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(S,{value:m,readOnly:!0,className:"bg-slate-50"}),e.jsx(y,{variant:"outline",onClick:()=>{navigator.clipboard.writeText(m),N.success("Webhook URL copied!")},children:"Copy"})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Add this webhook URL to your Printful dashboard to receive order status updates"})]}),e.jsxs(y,{onClick:j,disabled:t,className:"w-full",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Save Settings"]})]})]})}function ie(){const[l,d]=a.useState([]),[u,f]=a.useState("instagram"),[h,x]=a.useState(""),[m,g]=a.useState(""),[t,o]=a.useState([]),[p,j]=a.useState(""),[s,i]=a.useState(!1);a.useEffect(()=>{c(),b()},[]);const c=async()=>{const{data:n}=await r.from("social_media_posts").select("*").order("scheduled_time",{ascending:!0});n&&d(n)},b=async()=>{const{data:n}=await r.from("products").select("*");n&&o(n)},_=async()=>{if(m){i(!0);try{const n=t.find(k=>k.id===m),{data:P,error:I}=await r.functions.invoke("ai-campaign-generator",{body:{type:"social",productName:n.name,productDescription:n.description}});if(I)throw I;x(P.caption),N.success("AI caption generated!")}catch(n){N.error(n.message)}finally{i(!1)}}},O=async()=>{i(!0);try{const{data:{user:n}}=await r.auth.getUser();if(!n)throw new Error("Not authenticated");const P=t.find(R=>R.id===m),{data:I,error:k}=await r.functions.invoke("social-media-scheduler",{body:{platform:u,caption:h,imageUrl:P?.image_url,scheduledTime:p}});if(k)throw k;N.success("Post scheduled!"),c(),x(""),j("")}catch(n){N.error(n.message)}finally{i(!1)}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(C,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Schedule Social Media Post"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(T,{value:m,onValueChange:g,children:[e.jsx(U,{children:e.jsx(F,{placeholder:"Select product"})}),e.jsx(q,{children:t.map(n=>e.jsx(w,{value:n.id,children:n.name},n.id))})]}),e.jsxs(T,{value:u,onValueChange:f,children:[e.jsx(U,{children:e.jsx(F,{})}),e.jsxs(q,{children:[e.jsx(w,{value:"instagram",children:"Instagram"}),e.jsx(w,{value:"facebook",children:"Facebook"}),e.jsx(w,{value:"twitter",children:"Twitter"}),e.jsx(w,{value:"linkedin",children:"LinkedIn"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{value:h,onChange:n=>x(n.target.value),placeholder:"Post caption...",rows:4}),e.jsx(y,{onClick:_,disabled:s||!m,children:e.jsx(W,{className:"w-4 h-4"})})]}),e.jsx(Input,{type:"datetime-local",value:p,onChange:n=>j(n.target.value)}),e.jsxs(y,{onClick:O,disabled:s||!h,className:"w-full",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Schedule Post"]})]})]}),e.jsx("div",{className:"grid gap-4",children:l.map(n=>e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold capitalize",children:n.platform}),e.jsx("p",{className:"text-sm text-muted-foreground",children:n.caption}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:new Date(n.scheduled_time).toLocaleString()})]}),e.jsx("span",{className:"text-xs px-2 py-1 bg-primary/10 rounded",children:n.status})]})},n.id))})]})}function re(){const{user:l}=B(),[d,u]=a.useState(null),[f,h]=a.useState([]),[x,m]=a.useState(!0),[g,t]=a.useState(!1);a.useEffect(()=>{o(),p()},[l]);const o=async()=>{if(!l)return;const{data:c}=await r.from("shops").select("id").eq("user_id",l.id).single();if(c){const{data:b}=await r.from("integrations").select("*").eq("shop_id",c.id).eq("type","google_calendar").single();u(b)}m(!1)},p=async()=>{if(!l)return;const{data:c}=await r.from("shops").select("id").eq("user_id",l.id).single();if(c){const{data:b}=await r.from("calendar_sync_logs").select("*, bookings(customer_name)").eq("shop_id",c.id).order("created_at",{ascending:!1}).limit(10);h(b||[])}},j=async()=>{try{const{data:c,error:b}=await r.functions.invoke("google-oauth-initiate",{body:{userId:l?.id}});if(b)throw b;c?.authUrl&&(window.location.href=c.authUrl)}catch{alert("Failed to initiate OAuth")}},s=async()=>{d&&(await r.from("integrations").update({connected:!1,access_token:null}).eq("id",d.id),o())},i=async()=>{t(!0);const{data:c}=await r.from("shops").select("id").eq("user_id",l?.id).single();if(c){const{data:b}=await r.from("bookings").select("id").eq("shop_id",c.id).eq("status","scheduled");for(const _ of b||[])await r.functions.invoke("google-calendar-sync",{body:{bookingId:_.id,userId:l?.id}})}await p(),t(!1)};return x?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(Q,{className:"h-10 w-10 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:"Google Calendar"}),e.jsx("p",{className:"text-slate-600 mb-4",children:"Sync booking appointments automatically."}),d?.connected?e.jsxs("div",{className:"flex items-center gap-2 text-green-600 mb-2",children:[e.jsx(D,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Connected"})]}):e.jsxs("div",{className:"flex items-center gap-2 text-slate-500 mb-2",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:"Not Connected"})]})]})]}),e.jsx("div",{className:"flex gap-2",children:d?.connected?e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:i,disabled:g,variant:"outline",children:[e.jsx($,{className:`h-4 w-4 mr-2 ${g?"animate-spin":""}`}),"Sync Now"]}),e.jsx(y,{onClick:s,variant:"destructive",children:"Disconnect"})]}):e.jsx(y,{onClick:j,className:"bg-blue-600 hover:bg-blue-700",children:"Connect Calendar"})})]}),d?.connected&&f.length>0&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsx("h4",{className:"font-semibold text-slate-900 mb-4",children:"Recent Syncs"}),e.jsx("div",{className:"space-y-2",children:f.map(c=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[c.status==="success"?e.jsx(D,{className:"h-4 w-4 text-green-600"}):e.jsx(M,{className:"h-4 w-4 text-red-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-700",children:c.bookings?.customer_name||"Booking"}),c.error_message&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:c.error_message})]})]}),e.jsx("span",{className:"text-xs text-slate-500",children:new Date(c.created_at).toLocaleString()})]},c.id))})]})]})}function ge(){const{user:l}=B(),[d,u]=a.useState({}),[f,h]=a.useState(!0);a.useEffect(()=>{x()},[l]);const x=async()=>{if(!l)return;const{data:t}=await r.from("shops").select("id").eq("user_id",l.id).single();if(t){const{data:o}=await r.from("integrations").select("*").eq("shop_id",t.id),p=o?.reduce((j,s)=>(j[s.type]=s,j),{})||{};u(p)}h(!1)},m=async t=>{alert(`${t} integration will be available soon. OAuth flow will be implemented here.`)},g=[{type:"instagram",name:"Instagram",description:"Connect your Instagram business account to automate DM campaigns and track engagement.",icon:"ðŸ“·",status:d.instagram?.connected?"Connected":"Not Connected"},{type:"shopify",name:"Shopify",description:"Import products from your Shopify store and sync inventory automatically.",icon:"ðŸ›ï¸",status:d.shopify?.connected?"Connected":"Not Connected"},{type:"google_calendar",name:"Google Calendar",description:"Sync booking appointments to your Google Calendar automatically.",icon:"ðŸ“…",status:d.google_calendar?.connected?"Connected":"Not Connected"}];return e.jsxs("div",{className:"flex min-h-screen bg-slate-50",children:[e.jsx(J,{}),e.jsx("div",{className:"flex-1 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-900 mb-8",children:"Integrations"}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8",children:e.jsxs("p",{className:"text-blue-900 text-sm",children:[e.jsx("strong",{children:"Developer Note:"})," Integration endpoints are ready for OAuth implementation. The database schema and service layer are prepared for connecting external APIs."]})}),f?e.jsx("p",{className:"text-slate-600",children:"Loading integrations..."}):e.jsxs(ee,{defaultValue:"print",className:"space-y-6",children:[e.jsxs(se,{children:[e.jsx(L,{value:"print",children:"Print on Demand"}),e.jsx(L,{value:"social",children:"Social Media"}),e.jsx(L,{value:"other",children:"Other"})]}),e.jsxs(A,{value:"print",className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsx(te,{}),e.jsx(ne,{})]}),e.jsx(ae,{})]}),e.jsx(A,{value:"social",children:e.jsx(ie,{})}),e.jsxs(A,{value:"other",className:"space-y-6",children:[e.jsx(re,{}),g.filter(t=>t.type!=="google_calendar").map(t=>e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"text-4xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-slate-900 mb-2",children:t.name}),e.jsx("p",{className:"text-slate-600 mb-4",children:t.description}),e.jsx("span",{className:`inline-block px-3 py-1 rounded text-sm ${t.status==="Connected"?"bg-green-100 text-green-700":"bg-slate-100 text-slate-600"}`,children:t.status})]})]}),e.jsx("button",{onClick:()=>m(t.name),className:`px-6 py-3 rounded-lg font-semibold transition ${t.status==="Connected"?"bg-slate-200 text-slate-700 hover:bg-slate-300":"bg-purple-600 text-white hover:bg-purple-700"}`,children:t.status==="Connected"?"Disconnect":"Connect"})]})},t.type))]})]})]})})]})}export{ge as default};
//# sourceMappingURL=Integrations-DvjDC_ex.js.map
